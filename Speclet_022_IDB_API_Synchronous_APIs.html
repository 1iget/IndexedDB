<!DOCTYPE html>
<html lang='en-US'>
  <head>
    <meta http-equiv='Content-Type' content='text/html; charset=UTF-8'/>
    <title>Indexed Database API</title>
    <meta name='revision' content='$Id: Overview.html,v 1.41 2010/03/24 17:58:17 nmehta3 Exp $'/>
    <script src='http://dev.w3.org/2009/dap/ReSpec.js/js/respec.js' class='remove'></script>
    <script src='http://dev.w3.org/2009/dap/ReSpec.js/js/simple-node.js' class='remove'></script>
    <script class='remove'>
      var respecConfig = {
          specStatus:           "ED",

          shortName:            "IndexedDB",

          //publishDate:          "2010-01-05",

          previousPublishDate:  "2010-01-05",
          previousMaturity:     "WD",

          edDraftURI:           "http://dev.w3.org/2006/webapi/WebSimpleDB/",

          // if this is a LCWD, uncomment and set the end of its review period
          // lcEnd: "2009-08-05",

          extraCSS: [
                "http://dev.w3.org/2009/dap/ReSpec.js/css/respec.css",
                "SimpleDB.css"
          ],

          // editors, add as many as you like
          // only "name" is required
          editors:  [
              { name: "Nikunj Mehta", url: "mailto:nikunj@o-micron.com",
                company: "Invited Expert" },
              { name: "Jonas Sicking", url: "mailto:jonas@sicking.cc",
                company: "Mozilla" },
              { name: "Eliot Graff", url: "mailto:eliotgra@microsoft.com",
                company: "Microsoft" },
              { name: "Andrei Popescu", url: "mailto:andreip@google.com",
                company: "Google" }
              { name: "Jeremy Orlow", url: "mailto:jorlow@google.com",
                company: "Google" }
          ],

          maxTocLevel: 3,

          wg:           "Web Applications Working Group",

          wgURI:        "http://www.w3.org/2008/webapps/",

          wgPublicList: "public-webapps",

          wgPatentURI:  "http://www.w3.org/2004/01/pp-impl/42538/status",
      };
    </script>
    <script class="remove">
      function examples() {
        var examples = document.querySelectorAll('div.example');
        sn = new berjon.simpleNode({
                        "":     "http://www.w3.org/1999/xhtml",
                        "x":    "http://www.w3.org/1999/xhtml"
                    });
        for (var i = 0; i < examples.length; i++) {
          var example = examples.item(i);
          var header = sn.element('div', {'class': 'exampleHeader'}, null, 'Example');
          example.insertBefore(header, example.firstChild);
        }
      }

      function codeblocks() {
        document.normalize();
        sn = new berjon.simpleNode({
                        "":     "http://www.w3.org/1999/xhtml",
                        "x":    "http://www.w3.org/1999/xhtml"
                    });

        var blocks = document.querySelectorAll('codeblock');
        for (var i = 0; i < blocks.length; i++) {
          var codeblock = blocks.item(i);
          var div = sn.element('div', {'class': 'block'})
          sn.element('span', {'class': 'blockTitle'},
            sn.element('div', {'class': 'blockTitleDiv'}, div), 'ECMAScript');
          var code = sn.element('code', {'class': 'es-code'},
                       sn.element('pre', {'class': 'code'},
                         sn.element('div', {'class': 'blockContent'}, div)));
          sn.copyChildren(codeblock, code);
          codeblock.parentNode.replaceChild(div, codeblock);
        }
      }
      window.onload = function() {
        examples();
        codeblocks();
        (new berjon.respec()).loadAndRun();
      }
    </script>
    <!--[if IE]>
    <style type='text/css'>
      .ignore {
        -ms-filter:"progid:DXImageTransform.Microsoft.Alpha(Opacity=50)";
        filter: alpha(opacity=50);
      }
    </style>
    <![endif]-->
    <style type="text/css">
      table {
        border-collapse: collapse;
        border-style: hidden hidden none;
      }
      table thead {
        border-bottom: medium solid;
      }
      table td, table th {
        border-bottom: thin solid;
        border-left: medium solid;
        border-right: medium solid;
        padding: 0.2em;
        vertical-align: top;
      }
      h5 {
        display: none
      }
    </style>
  </head>

  <body>
    <section id="abstract">
      <p>
        This document defines APIs for a database of records holding simple values
        and hierarchical objects. Each record consists of a key and some value.
        Moreover, the database maintains indexes over records it stores. An
        application developer directly uses an API to locate records either by
        their key or by using an index. A query language can be layered on this
        API. An indexed database can be implemented using a persistent B-tree data
        structure.
      </p>
    </section>


    <section id="database-api" class="section">
      <h2>Indexed Database API</h2>

      <!-- begin-content -->
      <section id="sync-database" class="section">
        <h3>Synchronous APIs</h3>
        <p>
        The synchronous database API methods provide a blocking access pattern to IndexedDB 
        databases. Since they block the calling thread they are only available from workers.
        </p>
        <section id="opening-sync" class="section">
          <h4>Opening a database</h4>
          <p>
            <a title="WorkerUtils" class="externalDFN"><code>WorkerUtils</code></a> objects MUST implement the 
            <a><code>IDBEnvironmentSync</code></a> interface.
          </p>
          <p class="idl" title="WorkerUtils implements IDBEnvironmentSync">
          </p>
          
          <dl class="idl" title="[NoInterfaceObject] interface IDBEnvironmentSync">
            <dt>readonly attribute IDBFactorySync indexedDBSync</dt>
            <dd>This attribute provides applications a mechanism for accessing
              capabilities of indexed databases.</dd>
          </dl>
          
          <dl class="idl" title="interface IDBFactorySync">
            <dt>IDBDatabaseSync open()</dt>
            <dd>
              <p>
                When invoked, this method synchronously runs the <a>steps for opening a database</a>.
                Let <var>origin</var> be the origin of the <a>IDBEnvironmentSync</a> used to access
                this <a>IDBFactorySync</a> and <var>name</var> be the <var>name</var> argument passed
                to this function.
              </p>
              <p>
                If an error is returned from the steps above, then the implementation MUST
                throw an <a><code>IDBDatabaseException</code></a> with its 
                <a class="idlType" href="#widl-IDBDatabaseException-code"><code>code</code></a>
                and <a class="idlType" href="#widl-IDBDatabaseException-message"><code>message</code></a> set to
                appropriate values for the error.
              </p>
              <p>
                If the steps above are successful, the implementation MUST create a IDBDatabaseSync
                object representing the created <a>connection</a> and return it.
              </p>
              <dl class="parameters">
                <dt>DOMString name</dt>
                <dd>The <a title="database name">name</a> for the <a>database</a></dd>
              </dl>
            </dd>
            <dt>void deleteDatabase()</dt>
            <dd>
              <p>
                When invoked, this method synchronously runs the <a>steps for deleting a database</a>.
                Let <var>origin</var> be the origin of the <a>IDBEnvironmentSync</a> used to access
                this <a>IDBFactorySync</a> and <var>name</var> be the <var>name</var> argument passed
                to this function.
              </p>
              <p>
                If an error is returned from the steps above, then the implementation MUST
                throw an <a><code>IDBDatabaseException</code></a> with its 
                <a class="idlType" href="#widl-IDBDatabaseException-code"><code>code</code></a>
                and <a class="idlType" href="#widl-IDBDatabaseException-message"><code>message</code></a> set to
                appropriate values for the error.
              </p>
              <dl class="parameters">
                <dt>DOMString name</dt>
                <dd>The <a title="database name">name</a> of the <a>database</a> to be deleted.</dd>
              </dl>
            </dd>
          </dl>
        </section>
        
        <section id="database-interface-sync" class="section">
          <h4>Database</h4>
          <p>
          A database object provides access to the schema and data of a particular database.
          </p>
          <!-- TODO Add example. Should examples be in a separate section?-->
          <dl class="idl" title="interface IDBDatabaseSync">
            <dt>readonly attribute DOMString name</dt>
            <dd>
              On getting, this attribute MUST return the <a title="database name">name</a>
              of the <a title="connection">connected</a> <a>database</a>. The function MUST
              return this name even if the <a>closePending</a> flag is set on the <a>connection</a>.
              In other words, the return value from this function
              stays constant for the lifetime of the <a>IDBDatabaseSync</a> instance.
            </dd>
            <dt>readonly attribute DOMString version</dt>
            <dd>
              On getting, this attribute MUST return the <a>version</a> of this
              <a>database</a>. This attribute has the empty string value when the
              <a title="connection">connected</a> <a>database</a> is first created.
              Once the <a>closePending</a> flag is set on the <a>connection</a>, this
              function MUST return a snapshot of the <a>version</a> taken when the
              <a href="#widl-IDBDatabase-close">close</a> method was called. Even if
              other <a>connection</a>s are later used to change the <a>version</a> of the
              <a>database</a>. In other words, the return value from this function
              stays constant for the lifetime of the <a>IDBDatabaseSync</a> instance,
              unless <a href="#widl-IDBDatabaseSync-setVersion">setVersion</a> is called
              on this <a>IDBDatabaseSync</a> instance itself.
            </dd>
            <dt>readonly attribute DOMStringList objectStoreNames</dt>
            <dd>
              On getting, this attribute MUST return a list of names of the 
              <a title="object store">object stores</a> currently in the 
              <a title="connection">connected</a> <a>database</a>.
              Once the <a>closePending</a> flag is set on the <a>connection</a>, this
              function MUST return a snapshot of the list of names of the <a>object
              store</a>s taken at the time when the
              <a href="#widl-IDBDatabaseSync-close">close</a> method was called. Even if
              other <a>connection</a>s are later used to change the set of <a>object
              store</a>s that exist in the <a>database</a>. In other words, the return
              value from this function stays constant for the lifetime of the
              <a>IDBDatabaseSync</a> instance, unless
              <a href="#widl-IDBDatabaseSync-setVersion">setVersion</a> and
              <a href="#widl-IDBDatabaseSync-createObjectStore">createObjectStore</a> or
              <a href="#widl-IDBDatabaseSync-deleteObjectStore">deleteObjectStore</a>
              is called on this <a>IDBDatabaseSync</a> instance itself.
            </dd>
            <dt>IDBObjectStoreSync createObjectStore()</dt>
            <dd>
              <p>
                This method creates a and returns a new <a>object store</a> with the
                given name in the <a title="connection">connected</a> <a>database</a>. This method
                should only be called from inside a <a><code>VERSION_CHANGE</code></a> <a>transaction</a>.
              </p>
              <p>
				The <code>createObjectStore</code> method is tied to the instance of the database that 
				<a href="#widl-IDBDatabaseSync-setVersion-IDBTransactionSync-DOMString-version-IDBTransactionCallback-callback-unsigned-long-timeout">setVersion</a> 
				was called on and can make changes to that database instance only.
              </p>
              <p>
                If the <var>optionalParameters</var> argument is specified and has a <code>keyPath</code> property
                which is not <code>undefined</code> or <code>null</code>, then set <var>keyPath</var> to the value
                of this property. If <var>keyPath</var> is an <code>Array</code>, then each item in the array is
                converted to a string. If <var>keyPath</var> is not an <code>Array</code>, it is converted to a
                string.
              </p>
              <p>
                If <var>keyPath</var> is an <code>Array</code> and any items in the array is not a <a>valid key path</a>,
                or if <var>keyPath</var> is a string and is not a <a>valid key path</a> then a
                <a>NON_TRANSIENT_ERR</a> error MUST be thrown. Otherwise set the created <a>object store</a>'s
                <a title="object store key path">key path</a> is set to the value of <var>keyPath</var>.
              </p>
              <dl class="parameters">
                <dt>DOMString name</dt>
                  <dd>The <a title="object store name">name</a> of a new <a>object store</a></dd>
                <dt>optional Object optionalParameters</dt>
                  <dd>The <a>options object</a> whose attributes are optional parameters to this function.
                    Valid attributes are <code>keyPath</code> and <code>autoIncrement</code>.
                    <code>keyPath</code> specifies the <a title="object store key path">key path</a> of the new 
                    <a>object store</a>. If the attribute is <code>null</code>, <code>undefined</code>,
                    the empty string, or not present, no <a title="object store key path">key path</a> is
                    specified and thus keys are <a>out-of-line</a>.
                    <code>autoIncrement</code> specifies
                    whether the <a>object store</a> created should have a <a>key generator</a>.
                    It defaults to <code>false</code>.</dd>
              </dl>
              <dl class="exception" title="IDBDatabaseException">
                <dt>NOT_ALLOWED_ERR</dt>
                <dd>This method was not called from a <a><code>VERSION_CHANGE</code></a> <a>transaction</a>.</dd>
                <dt>CONSTRAINT_ERR</dt>
                  <dd>If an <a>object store</a> with the same name, compared in a case-sensitive
                  manner, already exists in the <a title="connection">connected</a> 
                  <a>database</a>.</dd>
                <dt>NON_TRANSIENT_ERR</dt>
                  <dd><code>optionalParameters</code> has attributes other
                  than <code>keyPath</code> and <code>autoIncrement</code>.</dd>
              </dl>
            </dd>
            <dt>void deleteObjectStore()</dt>
            <dd>
              <p>
                This method destroys an <a>object store</a> with the 
                given name as well as all <a title="index">indexes</a> that are 
                <a title="referenced">referencing</a> that <a>object store</a>. This method
                should only be called from inside a <a><code>VERSION_CHANGE</code></a> <a>transaction</a>.
              </p>
              <p>
              	The <code>deleteObjectStore</code> method is tied to the instance of the database that 
              	<a href="#widl-IDBDatabaseSync-setVersion-IDBTransactionSync-DOMString-version-IDBTransactionCallback-callback-unsigned-long-timeout">setVersion</a> 
              	was called on and can make changes to that database instance only.
              </p>
              
              <dl class="parameters">
                <dt>DOMString name</dt>
                <dd>The <a title="object store name">name</a> of an existing
                <a>object store</a></dd>
              </dl>
              <dl class="exception" title="IDBDatabaseException">
                <dt><a class="idlType" href="#widl-IDBDatabaseException-NOT_ALLOWED_ERR"><code>NOT_ALLOWED_ERR</code></a></dt>
                <dd>
                    This method was not called from a <a><code>VERSION_CHANGE</code></a> <a>transaction</a> callback.
                </dd>
                <dt><a class="idlType" href="#widl-IDBDatabaseException-NOT_FOUND_ERR"><code>NOT_FOUND_ERR</code></a></dt>
                <dd>
                If the <a>object store</a> with the given name, compared in a
                case-sensitive manner, does not already exist
                in the <a title="connection">connected</a> <a>database</a>.      
                </dd>
              </dl>
            </dd>
            <dt>void setVersion()</dt>
            <dd>
              This method updates the <a>version</a> of the <a>database</a> by following the
              <a>steps for running a <code>VERSION_CHANGE</code> transaction</a> using
              the <var>version</var> argument as <var>version</var> and the <a>IDBDatabaseSync</a>
              this function was called on as <var>connection</var>. 
              
              <p>
              	This method must throw an <a>IDBDatabaseException</a> with a <code>NOT_ALLOWED_ERR</code> description when it is called 
              	within the <a>IDBTransactionCallback</a> of a transaction method. 
              </p>
              
              <p>
              	Calling <code>setVersion</code>
              	while a first <code>setVersion</code> transaction is already running queues up another <code>setVersion</code> transaction 
              	to run after the first <code>setVersion</code> transaction is finished.
              </p>

              <p class="note">Processing a <code>setVersion</code> call may take a long time as it requires all other
              connections to the database to be closed, which in turn may depend on user input or other
              long-running tasks. If blocking for a long period of time is not acceptable for a given
              scenario then the asynchronous API should be used for version changes.</p>

              <dl class="parameters">
                <dt>DOMString      version</dt>
                <dd>The <a>version</a> to store in the <a>database</a></dd>
                <dt>IDBTransactionCallback callback</dt>
                <dd>
                	A callback which will be called with the newly created <code>VERSION_CHANGE</code> transaction. When the callback returns, the transaction is committed.
				</dd>
                <dt>optional unsigned long timeout</dt>
                <dd>Defines a transaction timeout value in milliseconds that will limit the 
                	lifetime of the <code>VERSION_CHANGE</code> transaction.  If the parameter is not provided, 
                	the value of <var>timeout</var> is infinite.</dd>
              </dl>
              <dl class="exception" title="IDBDatabaseException">
              	<dt>NOT_ALLOWED_ERR</dt>
              	<dd>
              		The <code>setVersion</code> method was called within the <a>IDBTransactionCallback</a> of a transaction method.
              	</dd>
              </dl>
            </dd>
            <dt>void transaction()</dt>
            <dd>
              <p>
                This method, when called MUST execute the
                <a title="create a transaction">steps for creating a transaction</a> in a sychronous
                fashion. The <var>storeNames</var>, <var>callback</var>, <var>mode</var>, and
                <var>timeout</var> arguments are forwarded to the algorithm as-is. The <var>connection</var>
                argument is set to the <a>IDBDatabaseSync</a> that the <code>transaction()</code> method was
                called on.
              </p>
              <p>
                The method returns a <a>IDBTransactionSync</a> object representing the <a>transaction</a>
                returned by the steps above.
              </p>
              <p>
              	This method MUST throw an <a>IDBDatabaseException</a> with a <code>NOT_ALLOWED_ERR</code> description 
              	when it is called within the <a>IDBTransactionCallback</a> of a <code>setVersion</code> method.
              </p>
              <dl class="parameters">
                <dt>any storeNames</dt>
                <dd>The names of <a title="object store">object stores</a> and 
                  <a title="index">indexes</a> in the <a>scope</a> of the new
                  <a>transaction</a></dd>
                <dt>IDBTransactionCallback callback</dt>
                <dd>A callback which will be called with the newly created transaction. When the callback returns,
                  the transaction is committed.</dd>
                <dt>optional unsigned short mode</dt>
                <dd>
                    The <a>mode</a> for isolating access to data inside the given
                    <a title="object store">object stores</a>. If this parameter is not provided, the default
                    access <a>mode</a> is <code>READ_ONLY</code>.
                </dd>
                <dt>optional unsigned long timeout</dt>
                <dd>The interval in milliseconds which this operation is allowed to 
                take to reserve all the <a>database</a> objects identified in the new
                <a title="transaction">transaction's</a> <a>scope</a>. The default
                is user agent specific</dd>
              </dl>
              <dl class="exception" title="IDBDatabaseException">
                <dt><a class="idlType" href="#widl-IDBDatabaseException-TIMEOUT_ERR"><code>TIMEOUT_ERR</code></a></dt>
                <dd>
                If <a title="transaction start">starting</a> the transaction takes longer than the specified timeout.
                </dd>
                <dt>NOT_ALLOWED_ERR</dt>
                <dd>
                	The <code>close()</code> method has been called on this <a>IDBDatabase</a> instance. 
                	Also thrown when The <code>transaction()</code> method was called within the <a>IDBTransactionCallback</a> of a <code>setVersion</code> method.</dd>
                <dt>NOT_FOUND_ERR</dt>
                <dd>One of the names provided in the <var>storeNames</var> argument doesn't exist in this <a>database</a>.</dd>
                <dt>NON_TRANSIENT_ERR</dt>
                <dd>The value for the <a>mode</a> parameter is invalid.</dd>
              </dl>
            </dd>
            <dt>void close()</dt>
            <dd>
                This method synchronously performs the <a>steps for closing a database connection</a> and returns once 
                the database has been closed.
            </dd>
          </dl>  
        </section>
        <section class="section" id="transaction-callback">
          <dl title='[NoInterfaceObject, Callback=FunctionOnly] interface IDBTransactionCallback' class='idl'> 
            <dt>void handleEvent (IDBTransactionSync transaction)</dt> 
            <dd> 
              <p> 
              The <a><code>transaction</code></a> that was just started.
              </p> 
            </dd> 
          </dl> 
        </section>
        <section class="section" id="object-store-sync">  
          <h4>Object Store</h4>
          <div class="example">       
            <p>
              In the following example, we set up an <a>object store</a> to use the 
              <a title="object store key path">key path</a> <em>id</em>. This
              <a>object store</a> is also designed to use a <a>key generator</a>.
            </p>
            <codeblock>var db = indexedDBSync.open('AddressBook');
if (db.version !== '1') {
    var vtx = db.setVersion('1');
    vtx.createObjectStore('Contact', 'id', true);
}
            </codeblock>
            <p class="issue">The scenario above doesn't actually work well because you have to unwind to
            the event loop to get the version transaction to commit before you can do something
            else. Leaving it like this for now, as this will get sorted out when we add callbacks
            for transactions in the sync API (we'll have to do it for the setVersion transaction 
            as well).</p>
            <p>
              Using this <a>database</a>, we can store records in the <em>Contact</em>
              <a>object store</a>. 
            </p>
            <codeblock>var tx = db.transaction();
var store = tx.objectStore('Contact');
var contact = store.add({name: 'Lincoln', number: '7012'});
// contact.id === 1
            </codeblock>
            <p>
              A stored value can be retrieved using the same key used by the
              first put operation.
            </p>
            <codeblock>var contact = store.get(1);
// contact.name === 'Lincoln'</codeblock>
            <p>
              A put operation will overwrite the record stored by the first 
              add operation with the same <a>key</a>.
            </p>
            <codeblock>var abraham = {id: 1, name: 'Abraham', number: '2107'};
store.put(abraham);</codeblock>
            <p>
              Now when the object store is read with the same key, the result 
              is different compared to the object read earlier.
            </p>
            <codeblock>var contact = store.get(1);
// contact.id === 1 &amp;&amp; contact.name === 'Abraham';</codeblock>
            <p>
              Additionally, all the <a>records</a> of an <a>object store</a> 
              matching a certain <a>key range</a> can be retrieved in key order.
            </p>
            <codeblock>var range = new IDBKeyRange.bound(2, 4);
var cursor = store.openCursor(range);
// each value is a contact and each key is the id for that  
// contact whose id is between 2 and 4, both inclusive
cursor.continue();</codeblock>
          </div>
          
          <dl title="interface IDBObjectStoreSync" class="idl">
            <dt>readonly attribute DOMString      name</dt>
            <dd>          
              On getting, provide the <a title="object store name">name</a> of this
              object store.        
            </dd>
            <dt>readonly attribute DOMString      keyPath</dt>
            <dd>
              On getting, provide the <a title="object store key path">key path</a>
              of this <a>object store</a>. If this attribute is <code>null</code>,
              the application MUST provide a key value for each modification operation.
            </dd>
            <dt>readonly attribute DOMStringList  indexNames</dt>
            <dd>
            On getting, provide a list of the names of <a title="index">indexes</a> on 
            objects in this <a>object store</a>.
            </dd>
            <dt>readonly attribute IDBTransactionSync transaction</dt>
            <dd>
              On getting, returns the <a>transaction</a> this <a>object store</a> belongs to.        
            </dd>
            <dt>any put()</dt>
            <dd>
              <p>
                This method throws a READ_ONLY_ERR if the transaction which this <a><code>IDBObjectStoreSync</code></a> belongs to 
                has its <a>mode</a> set to READ_ONLY. If any of the following conditions are true, this method
                throws a DATA_ERR exception:
              </p>
              <ul>
                <li>
                  The object store uses <a>in-line keys</a> and
                  the <var>key</var> parameter was provided.
                </li>
                <li>
                  The object store uses <a>out-of-line keys</a> and has no <a>key generator</a>
                  and the <var>key</var> parameter was not provided.
                </li>
                <li>
                  The object store uses <a>in-line keys</a>
                  and the result of <a title="evaluate key path">evaluating</a> the 
                  <a title="object store key path">object store's key path</a> yields a value and
                  that value is not a <a>valid key</a>.
                </li>
                <li>
                  The object store uses <a>in-line keys</a> but no <a>key generator</a>
                  and the result of <a title="evaluate key path">evaluating</a> the
                  <a title="object store key path">object store's key path</a> does not yield a value.
                </li>
                <li>
                  The <var>key</var> parameter was provided but does not contain a <a>valid key</a>.
                </li>
                <li>
                  If there are any <a>index</a>es <a title="referenced">referencing</a> this object
                  store whose <a title="index key path">key path</a> is a string,
                  <a title="evaluate key path">evaluating</a> their <a title="index key path">key path</a>
                  on the <var>value</var> parameter yields a value, and that value is not a <a>valid key</a>.
                </li>
                <li>
                  If there are any <a>index</a>es <a title="referenced">referencing</a> this object
                  store whose <a title="index key path">key path</a> is an <code>Array</code>,
                  <a title="evaluate key path">evaluating</a> any of the items in their <a title="index key path">key path</a>
                  on the <var>value</var> parameter yields a value and that value is not a <a>valid key</a>.
                </li>
              </ul>
              <p>
                Otherwise this method creates a <a>structured clone</a> of the <var>value</var> parameter.
                If this throws an exception that exception is rethrown. It then runs the <a>steps for
                synchronously executing a request</a> and returns the result, in this case the <a>key</a> of the stored object.
                The steps are run with this <a>IDBObjectStoreSync</a> as <var>source</var> and the <a>steps for
                storing a record into an object store</a> as <var>operation</var>, using this <a>IDBObjectStoreSync</a>
                as <var>store</var>, the created clone as <var>value</var>, the <var>key</var> parameter as
                <var>key</var>, and with the <var>no-overwrite flag</var> flag set to false.
              </p>
              <dl class="parameters">
                <dt>any value</dt>
                <dd>The value to be stored in the record</dd>
                <dt>optional any key</dt>
                <dd>The key used to identify the record</dd>
              </dl>
              <dl class="exception" title="IDBDatabaseException">
                <dt>TRANSACTION_INACTIVE_ERR</dt>
                <dd>The <a>transaction</a> this <a>IDBObjectStoreSync</a> belongs to is not <a>active</a>.</dd>
                <dt>READ_ONLY_ERR</dt>
                <dd>The <a>mode</a> of the associated <a>transaction</a> is <code>READ_ONLY</code>.</dd>
                <dt>DATA_ERR</dt>
                <dd>The calculated key for the insertion was not a <a>valid key</a>. Also thrown if the
                calculated key for any of the indexes which belong to this object store had a calculated
                key which was not a <a>valid key</a></dd>
                <dt>CONSTRAINT_ERR</dt>
                <dd>Another record in this <a>object store</a> has the same value for the <a>keyPath</a> of 
                a unique <a>index</a>.
                </dd>
              </dl>
              <dl class="exception" title="DOMException">
                <dt>DATA_CLONE_ERR</dt>
                <dd>The data being stored could not be cloned by the internal
                structured cloning algorithm.</dd>
              </dl>
            </dd>
            <dt>any add()</dt>
            <dd>
              <p>
                This method throws a READ_ONLY_ERR if the transaction which this <a>IDBObjectStoreSync</a> belongs to is
                has its <a>mode</a> set to READ_ONLY. If any of the following conditions are true, this method
                throws a DATA_ERR exception:
              </p>
              <ul>
                <li>
                  The object store uses <a>in-line keys</a> and
                  the <var>key</var> parameter was provided.
                </li>
                <li>
                  The object store uses <a>out-of-line keys</a> and has no <a>key generator</a>
                  and the <var>key</var> parameter was not provided.
                </li>
                <li>
                  The object store uses <a>in-line keys</a>
                  and the result of <a title="evaluate key path">evaluating</a> the 
                  <a title="object store key path">object store's key path</a> yields a value and
                  that value is not a <a>valid key</a>.
                </li>
                <li>
                  The object store uses <a>in-line keys</a> but no <a>key generator</a>
                  and the result of <a title="evaluate key path">evaluating</a> the
                  <a title="object store key path">object store's key path</a> does not yield a value.
                </li>
                <li>
                  The <var>key</var> parameter was provided but does not contain a <a>valid key</a>.
                </li>
                <li>
                  If there are any <a>index</a>es <a title="referenced">referencing</a> this object
                  store whose <a title="index key path">key path</a> is a string,
                  <a title="evaluate key path">evaluating</a> their <a title="index key path">key path</a>
                  on the <var>value</var> parameter yields a value, and that value is not a <a>valid key</a>.
                </li>
                <li>
                  If there are any <a>index</a>es <a title="referenced">referencing</a> this object
                  store whose <a title="index key path">key path</a> is an <code>Array</code>,
                  <a title="evaluate key path">evaluating</a> any of the items in their <a title="index key path">key path</a>
                  on the <var>value</var> parameter yields a value and that value is not a <a>valid key</a>.
                </li>
              </ul>
              <p>
                Otherwise this method creates a <a>structured clone</a> of the <var>value</var> parameter.
                If this throws an exception that exception is rethrown. It then runs the <a>steps for
                synchronously executing a request</a> and returns the <a>key</a> of the stored object.
                The steps are run with this <a>IDBObjectStoreSync</a> as <var>source</var> and the <a>steps for
                storing a record into an object store</a> as <var>operation</var>, using this <a>IDBObjectStoreSync</a>
                as <var>store</var>, the created clone as <var>value</var>, the <var>key</var> parameter as
                <var>key</var>, and with the <var>no-overwrite flag</var> flag set to true.
              </p>
              <dl class="parameters">
                <dt>any value</dt>
                <dd>The value to be stored in the record</dd>
                <dt>optional any key</dt>
                <dd>The key used to identify the record</dd>
              </dl>
              <dl class="exception" title="IDBDatabaseException">
                <dt>TRANSACTION_INACTIVE_ERR</dt>
                <dd>The <a>transaction</a> this <a>IDBObjectStoreSync</a> belongs to is not <a>active</a>.</dd>
                <dt>READ_ONLY_ERR</dt>
                <dd>The <a>mode</a> of the associated <a>transaction</a> is <code>READ_ONLY</code>.</dd>
                <dt>DATA_ERR</dt>
                <dd>The calculated key for the insertion was not a <a>valid key</a>. Also thrown if the
                calculated key for any of the indexes which belong to this object store had a calculated
                key which was not a <a>valid key</a></dd>
                <dt>CONSTRAINT_ERR</dt>
                <dd>A record
                exists in this <a>object store</a> for the key <var>key</var> parameter, or another record
                in this <a>object store</a> has the same value for the <a>keyPath</a> of a unique <a>index</a>.
                </dd>
              </dl>
              <dl class="exception" title="DOMException">
                <dt>DATA_CLONE_ERR</dt>
                <dd>The data being stored could not be cloned by the internal
                structured cloning algorithm.</dd>
              </dl>
            </dd>
            <dt>boolean delete()</dt>
            <dd>
              <p>
                This method throws a READ_ONLY_ERR if the transaction which this <a>IDBObjectStoreSync</a> belongs to is
                has its <a>mode</a> set to READ_ONLY. If the <var>key</var> parameter is not a <a>valid key</a>
                this method throws a DATA_ERR exception.
              </p>
              <p>
                Otherwise this method runs the <a>steps for synchronously executing a request</a>.
                The steps are run with this <a>IDBObjectStoreSync</a> as <var>source</var> and the <a>steps for deleting
                a record from an object store</a> as <var>operation</var>, using this <a>IDBObjectStoreSync</a>
                as <var>store</var> and the <var>key</var> parameter as <var>key</var>. The function returns the result
                of running these steps.
              </p>
              <dl class="parameters">
                <dt>any key</dt>
                <dd>Key identifying the record to be deleted</dd>
              </dl>
              <dl class="exception" title="IDBDatabaseException">
                <dt>TRANSACTION_INACTIVE_ERR</dt>
                <dd>The <a>transaction</a> this <a>IDBObjectStoreSync</a> belongs to is not <a>active</a>.</dd>
                <dt>READ_ONLY_ERR</dt>
                <dd>The <a>mode</a> of the <a>transaction</a> this <a>IDBObjectStoreSync</a> belongs to is READ_ONLY.</dd>
                <dt>NOT_FOUND_ERR</dt>
                <dd>A record did not exist in this <a>object store</a> 
                for the key <var>key</var> parameter.
                </dd>
              </dl>
            </dd>
            <dt>any get()</dt>
            <dd>
              <p>
                If the <var>key</var> parameter is not a <a>valid key</a> or a <a>key range</a>, this method
                throws a DATA_ERR exception. Otherwise, this method runs the <a>steps for synchronously executing
                a request</a> and returns the result of the operation. The steps are run with this
                <a>IDBObjectStoreSync</a> as <var>source</var> and the <a>steps for retrieving a value from an
                object store</a> as <var>operation</var>, using this <a>IDBObjectStoreSync</a> as <var>store</var> and the
                <var>key</var> parameter as <var>key</var>.
              </p>
              <p class="note">
                This function produces the same result if a record with the given key doesn't exist as when a record
                exists, but has <code>undefined</code> as value. If you need to tell the two situations apart, you can use
                <a href="#widl-IDBObjectStoreSync-openCursor">openCursor</a> with the same key. This will return a cursor with
                <code>undefined</code> as value if a record exists, or no cursor if no such record exists.
              </p>
              <dl class="parameters">
                <dt>any key</dt>
                <dd>Key identifying the <a>record</a> to be retrieved. This can also be a <a>IDBKeyRange</a> in which case
                the function retrieves the first existing value in that range.</dd>
              </dl>
              <dl class="exception" title="IDBDatabaseException">
                <dt>TRANSACTION_INACTIVE_ERR</dt>
                <dd>The <a>transaction</a> this <a>IDBObjectStoreSync</a> belongs to is not <a>active</a>.</dd>
                <dt>DATA_ERR</dt>
                <dd>The <var>key</var> parameter was not passed a valid value.</dd>
              </dl>
            </dd>
            <dt>void clear()</dt>
            <dd>
              <p>
                This method throws a READ_ONLY_ERR if the transaction which this <a>IDBObjectStoreSync</a> belongs to is
                has its <a>mode</a> set to READ_ONLY.
              </p>
              <p>
                Otherwise this method runs the <a>steps for synchronously executing a request</a>. The steps
                are run with this <a>IDBObjectStoreSync</a> as <var>source</var> and the
                <a>steps for clearing an object store</a> as <var>operation</var>, using
                this <a>IDBObjectStoreSync</a> as <var>store</var>.
              </p>
              <dl class="exception" title="IDBDatabaseException">
                <dt>TRANSACTION_INACTIVE_ERR</dt>
                <dd>The <a>transaction</a> this <a>IDBObjectStoreSync</a> belongs to is not <a>active</a>.</dd>
                <dt>READ_ONLY_ERR</dt>
                <dd>The <a>mode</a> of the <a>transaction</a> this <a>IDBObjectStoreSync</a> belongs to is READ_ONLY.</dd>
              </dl>
            </dd>
            <dt>IDBIndexSync createIndex()</dt>
            <dd>
              <p>
                This creates and returns a new <a>index</a> with the given name and parameters in the 
                <a title="connection">connected</a> <a>database</a>.  Note that this method must only
                be called from a <a><code>VERSION_CHANGE</code></a> <a>transaction</a>. The created
                index has its <a>unique</a> and <a>multientry</a> flags are set to the values of the
                <var>unique</var> and <var>multientry</var> properties in the <var>optionalParameters</var> argument.
              </p>
              <p>
                If the <var>keyPath</var> argument is an <code>Array</code>, then each item in the array is
                converted to a string. If <var>keyPath</var> is not an <code>Array</code>, it is converted to a
                string.
              </p>
              <p>
                If <var>keyPath</var> is an <code>Array</code> and any items in the array is not a <a>valid key path</a>,
                or if <var>keyPath</var> is a string and is not a <a>valid key path</a>, or if <var>keyPath</var> is
                and <code>Array</code> and the <var>multientry</var> property in the <var>optionalParameters</var> is true,
                then a <a>NON_TRANSIENT_ERR</a> error MUST be thrown. Otherwise set the created <a>object store</a>'s
                <a title="object store key path">key path</a> is set to the value of <var>keyPath</var>.
              </p>
              <dl class="parameters">
                <dt>DOMString      name</dt>
                  <dd>The <a title="index name">name</a> of a new <a>index</a></dd>
                <dt>DOMString      keyPath</dt>
                  <dd>The <a title="index key path">key path</a> used by the new
                  <a>index</a></dd>
                <dt>optional Object optionalParameters</dt>
                  <dd>The <a>options object</a> whose attributes are optional parameters to this function.
                    The valid options are <code>unique</code> and <code>multientry</code>.
                    <code>unique</code> specifies whether the <a>index</a>'s <a>unique</a> flag is
                    set. It defaults to <code>false</code>.
                    <code>multientry</code> specifies whether the <a>index</a>'s <a>multientry</a> flag is
                    set. It defaults to <code>false</code>.
                  </dd>
              </dl>
              <dl class="exception" title="IDBDatabaseException">
                <dt>NOT_ALLOWED_ERR</dt>
                  <dd>This method was not called from a <a><code>VERSION_CHANGE</code></a> 
                  <a>transaction</a>.</dd>
                <dt>CONSTRAINT_ERR</dt>
                  <dd>An <a>index</a> with the same name, compared in a 
                  case-sensitive manner, already exists in the 
                  <a title="connection">connected</a> <a>database</a>. 
                  Also thrown when creating a unique <a>index</a> on top of an <a>object store</a>
                  that already contains records that violate the unique constraint.</dd>
                <dt>NON_TRANSIENT_ERR</dt>
                  <dd><code>optionalParameters</code> has attributes other
                  than <code>unique</code>.</dd>
              </dl>
            </dd>
            <dt>IDBIndexSync index()</dt>
            <dd>
              Returns a <a>IDBIndexSync</a> representing a <a>index</a> that is part of the
              to this <a>object store</a>. Every call to this function on the same
              <a>IDBObjectStoreSync</a> instance and with the same <var>name</var> returns the same <a>IDBIndexSync</a> instance.
              However the retured <a>IDBIndexSync</a> instance is specific to this <a>IDBObjectStoreSync</a> instance. If this
              function is called on a different <a>IDBObjectStoreSync</a> instance, a different <a>IDBIndexSync</a> instance is
              returned. A result of this is that different <a>IDBTransactionSync</a>s use different <a>IDBIndexSync</a> instances
              to represent the same <a>index</a>.
              <dl class="parameters">
                <dt>DOMString name</dt>
                <dd>The <a title="index name">name</a> of an existing <a>index</a></dd>
              </dl>      
              <dl class="exception" title="IDBDatabaseException">
                <dt><a class="idlType" href="#widl-IDBDatabaseException-NOT_FOUND_ERR"><code>NOT_FOUND_ERR</code></a></dt>
                <dd>
                If the <a>index</a> with the given name does not exist 
                in the <a title="connection">connected</a> <a>database</a>.      
                </dd>
              </dl>
            </dd>
            <dt>void deleteIndex()</dt>
            <dd>
              <p>
                This method destroys the <a>index</a> with the given name in the
                <a title="connection">connected</a> <a>database</a>. Note that this
                method must only be called from a <a><code>VERSION_CHANGE</code></a>
                <a>transaction</a>.
              </p>
              <dl class="parameters">
                <dt>DOMString indexName</dt>
                <dd>The <a title="index name">name</a> of an existing <a>index</a></dd>
              </dl>
              <dl class="exception" title="IDBDatabaseException">
                <dt><a class="idlType" href="#widl-IDBDatabaseException-NOT_FOUND_ERR"><code>NOT_FOUND_ERR</code></a></dt>
                <dd>
                If the <a>index</a> with the given name does not exist 
                in the <a title="connection">connected</a> <a>database</a>.      
                </dd>
                <dt>NOT_ALLOWED_ERR</dt>
                <dd>This method was not called from a <a><code>VERSION_CHANGE</code></a>
                <a>transaction</a>.</dd>
              </dl>
            </dd>
            <dt>IDBCursorWithValueSync openCursor()</dt>
            <dd>
              <p>
                If the <var>range</var> parameter is specified but is not a <a>valid key</a> or a <a>key range</a>,
                this method throws a DATA_ERR exception. Otherwise, this method creates a <a>cursor</a>. The cursor
                MUST implement the <a>IDBCursorWithValueSync</a> interface.
              </p>
              <p>
                The newly created cursor MUST have an undefined <a>position</a>, a <a>direction</a> set to the value
                of the <var>direction</var> parameter, false as <a>iterable</a> flag value, and undefined
                <a title="cursor key">key</a> and <a title="cursor value">value</a>. The <a title="cursor source">source</a>
                of the cursor is the <a>IDBObjectStoreSync</a> this function was called on.
              </p>
              <p>
                If the <var>range</var> parameter is a <a>key range</a> then the cursor's <a>range</a> is set to that
                range. Otherwise, if the <var>range</var> parameter is a <a>valid key</a> then the cursor's <a>range</a>
                is set to <a>key range</a> containing only that key value. If the <var>range</var> parameter is not specified,
                the cursor's key range is left as undefined.
              </p>
              <p>
                This method runs the <a>steps for synchronously executing a request</a> and returns the result of the operation, in 
                this case an <a>IDBCursorSync</a> object. The steps are run with this <a>IDBObjectStoreSync</a> as <var>source</var> and the
                <a>steps for iterating a cursor</a> as <var>operation</var>,
                using the created cursor as <var>cursor</var> and with undefined as <var>key</var>.
              </p>
              <dl class="parameters">
                <dt>optional any    range</dt>
                <dd>The <a>key range</a> to use as the <a>cursor</a>'s <a>range</a></dd>
                <dt>optional unsigned short direction</dt>
                <dd>The <a>cursor</a>'s required <a>direction</a></dd>
              </dl>
              <dl class="exception" title="IDBDatabaseException">
                <dt>TRANSACTION_INACTIVE_ERR</dt>
                <dd>The <a>transaction</a> this <a>IDBObjectStoreSync</a> belongs to is not <a>active</a>.</dd>
                <dt>DATA_ERR</dt>
                <dd>The <var>range</var> parameter was not passed <a>key range</a> or a <a>valid key</a>.</dd>
              </dl>
            </dd>
          </dl>                
        </section>
        <section id="index-sync" class="section">  
          <h4>Index</h4>
          
          <div class="example">
            <p>
              An <a>index</a> can be created for retrieving records other than
              by using record keys. Continuing the earlier example, an 
              index could be maintained on the <em>name</em> property of objects
              in the <em>Contact</em> <a>object store</a>.
            </p>
            <codeblock>var db = <a>indexedDBSync</a>.<a>open</a>('AddressBook');
if (db.version === '1') {
    var vtx = db.<a>setVersion('2')</a>;
    var store = vtx.<a>objectStore</a>('Contact');
    store.<a>createIndex</a>('ContactName', 'name', false);
}</codeblock>
            <p class="issue">The scenario above doesn't actually work well because you have to unwind to
            the event loop to get the version transaction to commit before you can do something
            else. Leaving it like this for now, as this will get sorted out when we add callbacks
            for transactions in the sync API (we'll have to do it for the setVersion transaction 
            as well).</p>
            <p>
              For example, the <em>id</em> of an object with the <em>name</em> 
              property value 'Lincoln' can be retrieved using the 
              <em>ContactName</em> <a>index</a>.
            </p>
            <codeblock>var index = store.<a>openIndex</a>('ContactName');
var id = index.<a>get</a>('Lincoln');
// id === 1</codeblock>              
            <p>
              Additionally, all the records of an <a>object store</a> matching
              a certain range index keys can be retrieved in key order. When
              objects are retrieved from the <em>Contact</em> <a>object store</a>, 
              they are arranged by the value of the <em>id</em> attribute. On the
              other hand, when objects are retrieved using the <em>ContactName</em>
              <a>index</a>, they are arranged by the value of the <em>name</em> 
              property. 
            </p>
            <codeblock>var range = new <a>IDBKeyRange</a>.<a>bound</a>('L', 'M');
var cursor = index.<a>openCursor</a>(range);
// each value is a contact and each key is the name for that  
// contact whose name's first letter is either L or M
cursor.<a>continue</a>();</codeblock>
            <p>
              If, on the other hand, we only want the names and keys but not the whole <em>Contact</em>
              objects for a given range, then we can use a different mechanism for that.
            </p>
            <codeblock>var range = new <a>IDBKeyRange</a>.<a>bound</a>('L', 'M');
var cursor = index.<a>openKeyCursor</a>(range);
// each value is a contact id and each key is the name for that  
// contact whose name's first letter is either L or M
cursor.<a>continue</a>();</codeblock>
          </div>
              
          <dl class="idl" title="interface IDBIndexSync">
            <dt>readonly attribute DOMString      name</dt>
            <dd>
              On getting, provide the <a title="index name">name</a> of this <a>index</a>.        
            </dd>
            <dt>readonly attribute IDBObjectStoreSync objectStore</dt>
            <dd>
              On getting, returns a reference to the <a>IDBObjectStoreSync</a> instance for the
              <a>referenced</a> object store in this <a>IDBIndexSync</a>'s transaction. This MUST
              return the same <a>IDBObjectStoreSync</a> instance as was used to get a reference
              to this <a>IDBIndexSync</a>.
            </dd>
        
            <dt>readonly attribute DOMString      keyPath</dt>
            <dd>
              On getting, provide the <a title="index key path">key path</a> of this
              <a>index</a>. If this attribute is <code>null</code>,
              this <a>index</a> is not <a>auto-populated</a>.
            </dd>
            
            <dt>readonly attribute boolean unique</dt>
            <dd>
              On getting, provide the <a>unique</a> flag of this <a>index</a>.
            </dd>

            <dt>IDBCursorWithValueSync openCursor()</dt>
            <dd>
              <p>
                If the <var>range</var> parameter is specified but is not a <a>valid key</a> or a <a>key range</a>,
                this method throws a DATA_ERR exception. Otherwise, this method creates a <a>cursor</a>. The cursor
                MUST implement the <a>IDBCursorWithValueSync</a> interface.
              </p>
              <p>
                The newly created cursor MUST have an undefined <a>position</a>, a <a>direction</a> set to the value
                of the <var>direction</var> parameter, false as <a>iterable</a> flag value, and undefined
                <a title="cursor key">key</a> and <a title="cursor value">value</a>. The <a title="cursor source">source</a>
                of the cursor is the <a>IDBIndexSync</a> this function was called on.
              </p>
              <p>
                If the <var>range</var> parameter is a <a>key range</a> then the cursor's <a>range</a> is set to that
                range. Otherwise, if the <var>range</var> parameter is a <a>valid key</a> then the cursor's <a>range</a>
                is set to <a>key range</a> containing only that key value. If the <var>range</var> parameter is not specified,
                the cursor's key range is left as undefined.
              </p>
              <p>
                This method runs the <a>steps for synchronously executing
                a request</a> and returns the result, in this case a cursor object. The steps are run with this
                <a>IDBIndexSync</a> as <var>source</var> and the <a>steps for iterating a cursor</a> as <var>operation</var>,
                using the created cursor as <var>cursor</var> and with undefined as <var>key</var>
              </p>
              <dl class="parameters">
                <dt>optional IDBKeyRange    range</dt>
                <dd>The <a>key range</a> to use as the <a>cursor</a>'s <a>range</a></dd>
                <dt>optional unsigned short direction</dt>
                <dd>The <a>cursor</a>'s required <a>direction</a></dd>
              </dl>
              <dl class="exception" title="IDBDatabaseException">
                <dt>TRANSACTION_INACTIVE_ERR</dt>
                <dd>The transaction this <a>IDBIndexSync</a> belongs to is not <a>active</a>.</dd>
                <dt>DATA_ERR</dt>
                <dd>The <var>range</var> parameter was not passed a valid value.</dd>
              </dl>
            </dd>

            <dt>IDBCursorSync openKeyCursor()</dt>
            <dd>
              <p>
                If the <var>range</var> parameter is specified but is not a <a>valid key</a> or a <a>key range</a>,
                this method throws a DATA_ERR exception. Otherwise, this method creates a <a>cursor</a>. The cursor
                MUST implement the <a>IDBCursorSync</a> interface and MUST NOT implement the <a>IDBCursorWithValueSync</a>
                interface.
              </p>
              <p>
                The newly created cursor MUST have an undefined <a>position</a>, a <a>direction</a> set to the value
                of the <var>direction</var> parameter, false as <a>iterable</a> flag value, and undefined
                <a title="cursor key">key</a> and <a title="cursor value">value</a>. The <a title="cursor source">source</a>
                of the cursor is the <a>IDBIndexSync</a> this function was called on.
              </p>
              <p>
                If the <var>range</var> parameter is a <a>key range</a> then the cursor's <a>range</a> is set to that
                range. Otherwise, if the <var>range</var> parameter is a <a>valid key</a> then the cursor's <a>range</a>
                is set to <a>key range</a> containing only that key value. If the <var>range</var> parameter is not specified,
                the cursor's key range is left as undefined.
              </p>
              <p>
                This method runs the <a>steps for synchronously executing
                a request</a> and returns the result, in this case a cursor object. The steps are run with this
                <a>IDBIndexSync</a> as <var>source</var> and the <a>steps for iterating a cursor</a> as <var>operation</var>,
                using the created cursor as <var>cursor</var> and with undefined as <var>key</var>
              </p>
              <dl class="parameters">
                <dt>optional IDBKeyRange    range</dt>
                <dd>The <a>key range</a> to use as the <a>cursor</a>'s <a>range</a></dd>
                <dt>optional unsigned short direction</dt>
                <dd>The <a>cursor</a>'s required <a>direction</a></dd>
              </dl>
              <dl class="exception" title="IDBDatabaseException">
                <dt>TRANSACTION_INACTIVE_ERR</dt>
                <dd>The transaction this <a>IDBIndexSync</a> belongs to is not <a>active</a>.</dd>
                <dt>DATA_ERR</dt>
                <dd>The <var>range</var> parameter was not passed <a>key range</a> or a <a>valid key</a>.</dd>
              </dl>
            </dd>
            <dt>any get()</dt>
            <dd>
              <p>
                If the <var>key</var> parameter is not a <a>valid key</a> or a <a>key range</a>, this method
                throws a DATA_ERR exception. This method runs the <a>steps for synchronously executing a request</a>
                and returns the result from that, in this case an object from the underlying store. The steps are 
                run with this <a>IDBIndexSync</a> as <var>source</var> and the <a>steps 
                for retrieving a referenced value from an index</a> as <var>operation</var>, using this <a>IDBIndexSync</a> 
                as <var>index</var> and the <var>key</var> parameter as <var>key</var>.
              </p>
              <p class="note">
                This function produces the same result if a record with the given key doesn't exist as when a record
                exists, but has <code>undefined</code> as value. If you need to tell the two situations apart, you can use
                <a href="#widl-IDBIndexSync-openCursor">openCursor</a> with the same key. This will return a cursor with
                <code>undefined</code> as value if a record exists, or no cursor if no such record exists.
              </p>
              <dl class="parameters">
                <dt>any key</dt>
                <dd>Key identifying the record to be retrieved. This can also be a <a>IDBKeyRange</a> in which case
                the function retreives the first existing value in that range.</dd>
              </dl>
              <dl class="exception" title="IDBDatabaseException">
                <dt>TRANSACTION_INACTIVE_ERR</dt>
                <dd>The transaction this <a>IDBIndexSync</a> belongs to is not <a>active</a>.</dd>
                <dt>DATA_ERR</dt>
                <dd>The <var>key</var> parameter was not passed a valid value.</dd>
              </dl>
            </dd>
            <dt>any getKey()</dt>
            <dd>
              <p>
                If the <var>key</var> parameter is not a <a>valid key</a> or a <a>key range</a>, this method
                throws a DATA_ERR exception. This method runs the <a>steps for synchronously executing a request</a>
                and returns the result from that, in this case an index value (a <a>key</a>). The steps are 
                run with the <a>IDBObjectStoreSync</a> associated with this index as <var>source</var> and the <a>steps 
                for retrieving a value from an index</a> as <var>operation</var>, using this <a>IDBIndexSync</a> 
                as <var>index</var> and the <var>key</var> parameter as <var>key</var>.
              </p>
              <p class="note">
                This function produces the same result if a record with the given key doesn't exist as when a record
                exists, but has <code>undefined</code> as value. If you need to tell the two situations apart, you can use
                <a href="#widl-IDBIndexSync-openCursor">openCursor</a> with the same key. This will return a cursor with
                <code>undefined</code> as value if a record exists, or no cursor if no such record exists.
              </p>
              <dl class="parameters">
                <dt>any key</dt>
                <dd>Key identifying the record to be retrieved. This can also be a <a>IDBKeyRange</a> in which case
                the function retreives the first existing value in that range.</dd>
              </dl>
              <dl class="exception" title="IDBDatabaseException">
                <dt>TRANSACTION_INACTIVE_ERR</dt>
                <dd>The transaction this <a>IDBIndexSync</a> belongs to is not <a>active</a>.</dd>
                <dt>DATA_ERR</dt>
                <dd>The <var>key</var> parameter was not passed a valid value.</dd>
              </dl>
            </dd>
          </dl>
        </section>
        <section class="section" id="cursor-sync">  
          <h4>Cursor</h4>
          <p>
            Using the synchronous API, an application can process all the records
            in the <a>cursor</a>'s <a>range</a>. 
          </p>
          <div class="example">
            <p>
              By default, a <a>cursor</a> walks over objects starting at the
              first record and ending at the last record including
              all the duplicates encountered along the way. 
            </p>
            <codeblock>var tx = db.<a>transaction</a>('Contact');
var store = tx.<a>objectStore</a>('Contact');
var cursor = store.<a>openCursor</a>();
while(cursor.<a>continue</a>()) {
    var value = cursor.value;
    // act on each object or key
}
</codeblock>
            
            <p>
              To start at the last record and end in the first record, the cursor 
              should be created with the direction parameter <a class="idlType" href="#widl-IDBCursor-PREV"><code>PREV</code></a>.
            </p>
            <codeblock>var cursor = store.<a>openCursor</a>(<a>IDBCursorSync</a>.<a>PREV</a>);
while(cursor.<a>continue()</a>) {
    // act on each object or key
}
</codeblock>

            <p>
              To start at a certain key and end in the last record, i.e.,
              for a lower-bounded cursor, while skipping duplicates,
              the cursor should be created with both the required 
              start key and the direction parameter. 
            </p>
            
            <codeblock>var range = <a>IDBKeyRange</a>.leftBound(key);
var cursor = store.<a>openCursor</a>(range, <a>IDBCursorSync</a>.<a>NEXT_NO_DUPLICATE</a>);
</codeblock>
        
            <p>
              It is also possible to create a bounded cursor, i.e., with
              application-specified starting and ending points, the
              cursor should be created with both the required keys.
              If the range is inclusive of both keys, then additional
              flags are required. In the following example, all keys
              with values in the inclusive range (<code>start</code>, 
              <code>end</code>) are returned with all their duplicates,
              from the beginning of the range to its end.
            </p>
  
            <codeblock>var range = <a>IDBKeyRange</a>.bound(start, end);
var cursor = objects.<a>openCursor</a>(range);
</codeblock>
          </div>
          <dl title="interface IDBCursorSync" class="idl">
            <dt>const     unsigned short     NEXT = 0</dt>
            <dd>
              indicates that this <a>cursor</a> should yield all records, including  
              duplicates and its <a>direction</a> is monotonically increasing 
              order of keys.
            </dd>
            <dt>const     unsigned short     NEXT_NO_DUPLICATE = 1</dt>
            <dd>
              indicates that this <a>cursor</a> should yield all records, not including
              duplicates and its <a>direction</a> is monotonically increasing 
              order of keys. For every key with duplicate values, only the first
              record is yielded.
            </dd>
            <dt>const     unsigned short     PREV = 2</dt>
            <dd>
              indicates that <a>cursor</a> should yield all records, including  
              duplicates and its <a>direction</a> is monotonically decreasing 
              order of keys.
            </dd>
            <dt>const     unsigned short     PREV_NO_DUPLICATE = 3</dt>
            <dd>
              indicates that this <a>cursor</a> should yield all records, not including
              duplicates and its <a>direction</a> is monotonically decreasing 
              order of keys. For every key with duplicate values, only the first
              record is yielded.
            </dd>
            <dt>readonly attribute Object             source</dt>
            <dd>
            On getting, returns the <a>IDBObjectStoreSync</a> or <a>IDBIndexSync</a> which this cursor is iterating. This function
            never returns null or throws an exception, even if the cursor is currently being iterated, has iterated past its end,
            or its transaction is not <a>active</a>.
            </dd>
            <dt>readonly attribute unsigned short     direction</dt>
            <dd>            
            On getting, provide the traversal <a>direction</a> of the <a>cursor</a>.
            </dd>
            <dt>readonly attribute any key</dt>
            <dd>The key for the record at the <a>cursor</a>'s <a>position</a>. However if the cursor's <a>got value</a>
            flag is false it returns <code>undefined</code>. I.e. if it's currently being iterated or has
            iterated past the end of its range.</dd>

            <dt>IDBRequest update()</dt>
            <dd>
              <p>
                This method throws a READ_ONLY_ERR if the transaction which this IDBCursorSync belongs to
                has its <a>mode</a> set to READ_ONLY. If this cursor's <a>got value</a> flag is false or if this
                cursor was created using
                <a class="idlType" href="#widl-IDBIndex-openKeyCursor"><code>openKeyCursor</code></a>. This method
                throws a NOT_ALLOWED_ERR. If the <a>effective object store</a> of this cursor uses <a>in-line</a>
                keys and <a title="evaluate key path">evaluating</a> the <a title="object store key path">key path</a>
                of the <var>value</var> parameter results in a different value than the cursor's <a>effective key</a>,
                this method throws DATA_ERR.
              </p>
              <p>
                Otherwise this method creates a <a>structured clone</a> of the <var>value</var> parameter.
                If this throws an exception that exception is rethrown. It then runs the <a>steps for
                synchronously executing a request</a> and returns the result returned by these steps.
                The steps are run with this IDBCursorSync as <var>source</var> and the <a>steps for
                storing a record into an object store</a> as <var>operation</var>, using this cursor's
                <a>effective object store</a> as <var>store</var>, the created clone as <var>value</var>,
                this cursor's <a>effective key</a> as <var>key</var>, and with the <var>no-overwrite flag</var>
                flag set to false.
              </p>
              <p class="note">
                A result of running the <a>steps for storing a record into an object store</a> is that if the record
                has been deleted since the cursor moved to it, a new record will be created.
              </p>
              <dl class="parameters">
                <dt>any value</dt>
                <dd>The new value to store at the current position.</dd>
              </dl>
              <dl class="exception" title="IDBDatabaseException">
                <dt>TRANSACTION_INACTIVE_ERR</dt>
                <dd>The <a>transaction</a> this <a>IDBCursor</a> belongs to is not <a>active</a>.</dd>
                <dt>READ_ONLY_ERR</dt>
                <dd>The <a>mode</a> of the <a>transaction</a> this <a>IDBCursor</a> belongs to
                is <code>READ_ONLY</code></dd>
                <dt>NOT_ALLOWED_ERR</dt>
                <dd>Thrown if cursor was created using
                <a class="idlType" href="#widl-IDBIndex-openKeyCursor"><code>openKeyCursor</code></a> or if the cursor
                is currently being iterated or has iterated past the end.</dd>
                <dt>DATA_ERR</dt>
                <dd> The underlying <a>object store</a> uses <a>in-line keys</a> and the property in <var>value</var>
                at the object store's <a title="object store key path">key path</a> does not match the key in this <a>cursor</a>'s
                <a>position</a>.</dd>
              </dl>
              <dl class="exception" title="DOMException">
                <dt>DATA_CLONE_ERR</dt>
                <dd>The data being stored could not be cloned by the internal
                structured cloning algorithm.</dd>
              </dl>
            </dd>

            <dt>boolean  advance()</dt>
            <dd>
              <p>
                This method runs the <a>steps for synchronously executing a request</a>.
                The steps are run with the cursor's <a title="cursor source">source</a> as <var>source</var>.
                The <var>operation</var> runs the <a>steps for iterating a cursor</a> <var>count</var> number of times
                with null as <var>key</var> and this cursor as <var>cursor</var>. If the <a>steps for synchronously
                executing a request</a> returns a cursor, then this function returns <code>true</code>. Otherwise
                this function returns <code>false</code>.
              </p>
              <dl class="parameters">
                <dt>int count</dt>
                <dd>The number of advances forward the cursor should make.</dd>
              </dl>
            </dd>

            <dt>boolean  continue()</dt>
            <dd>
              <p>
                If this cursor's <a>got value</a> flag is false, this method throws a <a>NOT_ALLOWED_ERR</a>.
                If the <var>key</var> parameter is specified and fulfills any of these conditions this
                method MUST throw a <a>DATA_ERR</a> exception:
              </p>
              <ul>
                <li>The parameter is not a <a>valid key</a>.</li>
                <li>
                  The parameter is <a>less than</a> or <a>equal to</> this cursor's <a>position</a>
                  and this cursor's <a>direction</a> is NEXT or NEXT_NO_DUPLICATE.
                </li>
                <li>
                  The parameter is <a>greater than</a> or <a>equal to</> this cursor's <a>position</a>
                  and this cursor's <a>direction</a> is PREV or PREV_NO_DUPLICATE.
                </li>
              </ul>
              <p>
                Otherwise this method runs the <a>steps for synchronously executing a request</a>.
                The steps are run with the cursor's <a title="cursor source">source</a> as <var>source</var> and the <a>steps 
                for iterating a cursor</a> as <var>operation</var>, using the cursor this is called on as <var>cursor</var> and 
                the <var>key</var> parameter as <var>key</var>. If the <a>steps for synchronously executing a request</a> returns
                a cursor, then this function returns <code>true</code>. Otherwise this function returns <code>false</code>.
              </p>
              <p>
                Before this method returns, unless an exception was thrown, it sets the <a>got value</a> flag in the cursor to false.
              </p>
              <p>
              	If you call this method multiple times, the cursor throws a <a>NOT_ALLOWED_ERR</a> exception and does not continue. 
              	If you catch the error you can then iterate through the cursor normally.
              </p>
              <dl class="parameters">
                <dt>optional any key</dt>
                <dd>The next key to position this <a>cursor</a> at</dd>
              </dl>
              <dl class="exception" title="IDBDatabaseException">
                <dt>TRANSACTION_INACTIVE_ERR</dt>
                <dd>The <a>transaction</a> this <a>IDBCursor</a> belongs to is not <a>active</a>.</dd>
                <dt>NOT_ALLOWED_ERR</dt>
                <dd>The cursor is currently being iterated, or has iterated past its end.</dd>
                <dt>DATA_ERR</dt>
                <dd>The <var>key</var> parameter was specified but did not contain a <a>valid key</a>.</dd>
              </dl>
            </dd>
            
            <dt>boolean  delete()</dt>
            <dd>
              <p>
                This method throws a READ_ONLY_ERR if the transaction which this <a>IDBCursorSync</a> belongs to
                has its <a>mode</a> set to READ_ONLY. If this cursor's <a>got value</a> flag is false,
                or if this cursor was created using
                <a class="idlType" href="#widl-IDBIndex-openKeyCursor"><code>openKeyCursor</code></a> a
                NOT_ALLOWED_ERR is thrown.
              </p>
              <p>
                Otherwise this method runs the <a>steps for synchronously executing a request</a>. The steps are run 
                with this <a>IDBCursorSync</a> as <var>source</var> and the <a>steps for deleting a record from an 
                object store</a> as <var>operation</var>, using this cursor's <a>effective object store</a> and 
                <a>effective key</a> as <var>store</var> and <var>key</var> respectively. The function returns the
                result of running these steps.
              </p>
              <p class="issue">
                This method used to set this cursor's <a title="cursor value">value</a> to <code>null</code>. Do we want to
                keep that?
              </p>
              <dl class="exception" title="IDBDatabaseException">
                <dt>TRANSACTION_INACTIVE_ERR</dt>
                <dd>The <a>transaction</a> this <a>IDBCursorSync</a> belongs to is not <a>active</a>.</dd>
                <dt>READ_ONLY_ERR</dt>
                <dd>The <a>mode</a> of the <a>transaction</a> this <a>IDBCursorSync</a> belongs to
                is <code>READ_ONLY</code>.</dd>
                <dt>NOT_ALLOWED_ERR</dt>
                <dd>The cursor was created using
                <a class="idlType" href="#widl-IDBIndexSync-openKeyCursor"><code>openKeyCursor</code></a> or the cursor
                is currently being iterated or has iterated past the end.</dd>
              </dl>
            </dd>
          </dl>
          <dl title="interface IDBCursorWithValueSync : IDBCursorSync" class="idl">
            <dt>attribute any value</dt>
            <dd>The value for the record at the <a>cursor</a>'s <a>position</a>. However if the cursor's <a>got value</a>
            flag is false it returns <code>undefined</code>. I.e. if it's currently being iterated or has
            iterated past the end of its range. Note that if this property returns an object, it returns the same
            object instance every time it is inspected, until the cursor is iterated. This means that if the object is modified,
            those modifications will be seen by anyone inspecting the value of the cursor. However modifying such an object
            does not modify the contents of the database.
            </dd>
          </dl>
        </section>
        <section id="transaction-sync" class="section">
          <h4>Transaction</h4>
          <!-- TODO Add example. Should examples be in a separate section?-->
          <p>
            When an application <a title="create a transaction">creates</a> a 
            <a>transaction</a> synchronously, it blocks until the user agent is able
            to reserve the required <a>database</a> <a>objects</a>.
          </p>
          <dl class="idl" title="interface IDBTransactionSync">
            <dt>const     unsigned short READ_ONLY    = 0</dt>
            <dd>Modification operations are not allowed in the <a>transaction</a>
            in this mode.</dd>
            <dt>const     unsigned short READ_WRITE    = 1</dt>
            <dd>Modification operations are allowed in the <a>transactions</a>
            in this mode.</dd>
            <dt>const     unsigned short VERSION_CHANGE = 2</dt>
            <dd>This mode is used solely for updating the version number of
            transactions started using the <code>setVersion()</code> method of <a><code>IDBDatabaseSync</code></a>.</dd>
            <dt>readonly attribute unsigned short mode</dt>
            <dd>On getting, provide the <a>mode</a> for isolating access to data inside
            the <a title="object store">object stores</a> that are in the
            <a>scope</a> of the <a>transaction</a>.</dd>
            <dt>attribute IDBDatabaseSync db</dt>
            <dd>The <a>database</a> <a>connection</a> of which this <a>transaction</a>
              is a part</dd>
            <dt>IDBObjectStoreSync objectStore()</dt>
            <dd>
              Returns a <a>IDBObjectStoreSync</a> representing a <a>object store</a> that is within the <a>scope</a> of this <a>transaction</a>. 
              Every call to this function on the same <a>IDBTransactionSync</a> instance and with the same <var>name</var> returns the same <a>IDBObjectStoreSync</a> instance.
              However the retured <a>IDBObjectStoreSync</a> instance is specific to this <a>IDBTransactionSync</a>. 
              If this function is called on a different <a>IDBTransactionSync</a>, a different <a>IDBObjectStoreSync</a> instance is returned.
              <dl class="parameters">
                <dt>DOMString name</dt>
                <dd>The requested <a>object store</a></dd>
              </dl>
              <dl class="exception" title="IDBDatabaseException">
                <dt><a class="idlType" href="#widl-IDBDatabaseException-NOT_FOUND_ERR"><code>NOT_FOUND_ERR</code></a></dt>
                <dd>
                If the requested <a>object store</a> is not in this 
                <a>transaction</a>'s <a>scope</a>.
                </dd>
              </dl>
            </dd>
            <dt>void abort()</dt>
            <dd>
              If this <a>transaction</a> is <a title="transaction finish">finished</a>, throw a NOT_ALLOWED_ERR
              exception. Otherwise this method <a title="transaction abort">aborts</a> the transaction by running the
              <a>steps for aborting a transaction</a> with <var>code</var> set to ABORT_ERR.
              <dl class="exception" title="IDBDatabaseException">
                <dt>NOT_ALLOWED_ERR</dt>
                <dd>If this <a>transaction</a> has already been committed or aborted.</dd>
              </dl>
            </dd>
          </dl>
          <div class="note">
            Applications MUST not assume that committing the <a>transaction</a>
            produces an instantaneously durable result. The user agent
            MAY delay flushing data to durable storage until an appropriate
            time.
          </div>
                              
          <p>
            Once a <a>transaction</a> is aborted or committed, the <a>active</a> 
            <a>transaction</a> on this <a>database</a> <a>connection</a> is removed.
            A new <a>transaction</a> can be created to perform operations atomically.
          </p>
        </section> <!-- IDBTransaction -->
       </section>
      </section>
      <!-- end-content -->
     </section>
  </body>
</html>
