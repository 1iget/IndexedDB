<!DOCTYPE html>
<html lang='en-US'>
  <head>
    <meta http-equiv='Content-Type' content='text/html; charset=UTF-8'/>
    <title>Indexed Database API</title>
    <script src='//www.w3.org/Tools/respec/respec-w3c-common' class='remove' async></script>
    <script class='remove'>
      var respecConfig = {
          specStatus:           "ED",

          shortName:            "IndexedDB",

          //publishDate:          "2010-01-05",

          previousPublishDate:  "2010-01-05",
          previousMaturity:     "WD",

          edDraftURI:           "http://dev.w3.org/2006/webapi/WebSimpleDB/",

          // if this is a LCWD, uncomment and set the end of its review period
          // lcEnd: "2009-08-05",

          // editors, add as many as you like
          // only "name" is required
          editors:  [
              { name: "Nikunj Mehta", url: "mailto:nikunj@o-micron.com",
                company: "Invited Expert" },
              { name: "Jonas Sicking", url: "mailto:jonas@sicking.cc",
                company: "Mozilla" },
              { name: "Eliot Graff", url: "mailto:eliotgra@microsoft.com",
                company: "Microsoft" },
              { name: "Andrei Popescu", url: "mailto:andreip@google.com",
                company: "Google" },
              { name: "Jeremy Orlow", url: "mailto:jorlow@google.com",
                company: "Google" },
              { name: "Joshua Bell", url: "mailto:jsbell@google.com",
                company: "Google" }
          ],

          maxTocLevel: 3,

          wg:           "Web Applications Working Group",

          wgURI:        "http://www.w3.org/2008/webapps/",

          wgPublicList: "public-webapps",

          wgPatentURI:  "http://www.w3.org/2004/01/pp-impl/42538/status",

          noIDLSectionTitle: true,
      };
    </script>

    <style type="text/css">
      table {
        border-collapse: collapse;
        border-style: hidden hidden none;
      }
      table thead {
        border-bottom: medium solid;
      }
      table td, table th {
        border-bottom: thin solid;
        border-left: medium solid;
        border-right: medium solid;
        padding: 0.2em;
        vertical-align: top;
      }
      .example .example .example-title {
          display: none
      }
    </style>
  </head>

  <body>
    <section id="abstract">
      <p>
        This document defines APIs for a database of records holding simple values
        and hierarchical objects. Each record consists of a key and some value.
        Moreover, the database maintains indexes over records it stores. An
        application developer directly uses an API to locate records either by
        their key or by using an index. A query language can be layered on this
        API. An indexed database can be implemented using a persistent B-tree data
        structure.
      </p>
    </section>


    <section id="database-api" class="section">
      <h2>Indexed Database API</h2>

      <!-- begin-content -->
      <section id="sync-database" class="section">
        <h3>Synchronous APIs</h3>
        <p class="note">
        	The features in Section 3.3 Synchronous APIs are at risk and may be removed, due to potential lack of implementations.
        </p>
        <p>
        The synchronous database API methods provide a blocking access pattern to IndexedDB
        databases. Since they block the calling thread they are only available from workers.
        </p>
        <section id="opening-sync" class="section">
          <h4>Opening a database</h4>
          <p>
            <a class="externalDFN"><code>WorkerUtils</code></a> objects MUST implement the
            <a>IDBEnvironmentSync</a> interface.
          </p>
          <p class="idl" title="WorkerUtils implements IDBEnvironmentSync">
          </p>

          <dl class="idl" title="[NoInterfaceObject] interface IDBEnvironmentSync">
            <dt>readonly attribute IDBFactorySync indexedDBSync</dt>
            <dd>This attribute provides applications a mechanism for accessing
              capabilities of indexed databases.</dd>
          </dl>

          <dl class="idl" title="interface IDBFactorySync">
            <dt>IDBDatabaseSync open()</dt>
            <dd>
              <p>
                If this method is called within the <a>IDBTransactionCallback</a> of a <code>transaction</code>
                method or the <a>IDBVersionChangeCallback</a> of a <code>open</code> method,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>InvalidStateError</code></a>.

                Otherwise this method
                synchronously runs the <a>steps for opening a database</a>. Let <var>origin</var> be the origin of the
                <a>IDBEnvironmentSync</a> used to access this <a>IDBFactorySync</a>, <var>name</var>, <var>version</var>
                and <var>upgrade callback</var> be the <var>name</var>, <var>version</var> and <var>upgradeCallback</var>
                arguments passed to this function. If the <var>version</var> parameter is not specified,
                let <var>version</var> be <code>undefined</code>.
              </p>
              <p>
                If the value of <var>version</var> is <code>0</code> (zero),
                the implementation MUST throw a <code>TypeError</code>.
              </p>
              <p class="note">
                If <var>version</var> is not specified and a <a>database</a> with that name already exists,
                a connection will be opened without changing the <a>version</a>. If <var>version</var>
                is not specified and no <a>database</a> with that name exists, a new <a>database</a>
                will be created with <a>version</a> equal to <code>1</code>.
              </p>
              <p>
                If a <var>timeout</var> parameter was supplied, then this limits the total waiting time allowed in
                step 3 of <a>steps for opening a database</a> and step 4 of the <a>steps for running a
                <code>"versionchange"</code> transaction</a>. If more waiting time would be needed in order to progress,
                then abort those algorithms and
                throw a <code>DOMException</code> of type <a><code>TimeoutError</code></a>.
              </p>
              <p class="note">
                The <var>timeout</var> parameter does not affect how long the <var>upgradeCallback</var> can run.
              </p>
              <p>
                If an error is returned from the steps above, then
                the implementation MUST throw a <code>DOMException</code> with its name and message set to appropriate values for the error.
              </p>
              <p>
                If the steps above are successful, the implementation MUST create an <a>IDBDatabaseSync</a>
                object representing the created <a>connection</a> and return it.
              </p>
              <p class="note">
                Processing a <code>open</code> call may take a long time as it could require running a
                <code>"versionchange"</code> transaction which requires all other connections to the database to be closed, which
                in turn may depend on user input or other long-running tasks. If blocking for a long period of time
                is not acceptable for a given scenario then the asynchronous API should be used for version changes.
              </p>
              <p>
              	If the value for <code>version</code> is <code>0</code> (zero) or a negative number, this method MUST
              	throw a <code>TypeError</code>.
              </p>
              <dl class="parameters">
                <dt>DOMString name</dt>
                <dd>The <a title="database name">name</a> for the <a>database</a></dd>
                <dt>[EnforceRange] optional unsigned long long version</dt>
                <dd>The <a>version</a> for the <a>database</a></dd>
                <dt>IDBVersionChangeCallback upgradeCallback</dt>
                <dd>Callback used if the database <a>version</a> needs to be upgraded before the
                database can be opened.</dd>
                <dt>optional unsigned long timeout</dt>
                <dd>Defines a transaction timeout value in milliseconds that will limit the
                    how long waiting for the <code>"versionchange"</code> transaction.  If the parameter is not provided,
                    the value of <var>timeout</var> is infinite.</dd>
              </dl>
            </dd>
            <dt>void deleteDatabase()</dt>
            <dd>
              <p>
                When invoked, this method synchronously runs the <a>steps for deleting a database</a>.
                Let <var>origin</var> be the origin of the <a>IDBEnvironmentSync</a> used to access
                this <a>IDBFactorySync</a> and <var>name</var> be the <var>name</var> argument passed
                to this function.
              </p>
              <p>
                If an error is returned from the steps above, then
                the implementation MUST throw a <code>DOMException</code> with its name and message set to appropriate values for the error.
              </p>
              <dl class="parameters">
                <dt>DOMString name</dt>
                <dd>The <a title="database name">name</a> of the <a>database</a> to be deleted.</dd>
              </dl>
            </dd>
                        <dt>short cmp()</dt>
            <dd>
              <p>
                When invoked, this method MUST compare two <a title="key">keys</a>. The method returns 1 if the first key is
                <a>greater than</a> the second, -1 if the first is <a>less than</a> the second, and 0 if
                the first is <a>equal to</a> the second.
              </p>
              <dl class="parameters">
                <dt>any first</dt>
                <dd>The first <a>key</a> to compare.</dd>
                <dt>any second</dt>
                <dd>The second <a>key</a> to compare.</dd>
              </dl>
              <p>
                If either <var>first</var> or <var>second</var> is not a <a>valid key</a>,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>DataError</code></a>.
              </p>
            </dd>
          </dl>
        </section>

        <section id="database-interface-sync" class="section">
          <h4>Database</h4>
          <p>
          A database object provides access to the schema and data of a particular database.
          </p>
          <!-- TODO Add example. Should examples be in a separate section?-->
          <dl class="idl" title="interface IDBDatabaseSync">
            <dt>readonly attribute DOMString name</dt>
            <dd>
              On getting, this attribute MUST return the <a title="database name">name</a>
              of the <a title="connection">connected</a> <a>database</a>. The function MUST
              return this name even if the <a>closePending</a> flag is set on the <a>connection</a>.
              In other words, the return value from this function
              stays constant for the lifetime of the <a>IDBDatabaseSync</a> instance.
            </dd>
            <dt>readonly attribute unsigned long long version</dt>
            <dd>
              On getting, this attribute MUST return the <a>version</a> of the
              <a>database</a> when this <a>IDBDatabaseSync</a> instance was created.
              When a <a>IDBDatabaseSync</a> instance is created,
              this is always the number passed as the <var>version</var>
              argument passed to the <a href="#widl-IDBFactory-open-IDBOpenDBRequest-DOMString-name-unsigned-long-long-version"><code>open</code></a>
              call used to create the <a>IDBDatabaseSync</a> instance. This value remains constant for the lifetime of the <a>IDBDatabaseSync</a> object.
              If the <a>connection</a> is closed, this attribute represents a
              snapshot of the version that the <a>database</a> had when the connection
              was closed. Even if another <a>connection</a> is later used to modify the
              <a>version</a>, that attribute on closed instances are not changed.
            </dd>
            <dt>readonly attribute DOMStringList objectStoreNames</dt>
            <dd>
              On getting, this attribute MUST return a list of names of the
              <a title="object store">object stores</a> currently in the
              <a title="connection">connected</a> <a>database</a>. The list MUST
              be sorted in ascending order using the algorithm defined by step 4
              of <cite>section 11.8.5, The Abstract Relational Comparison Algorithm</cite>
              of the ECMAScript Language Specification [[!ECMA-262]].
              Once the <a>closePending</a> flag is set on the <a>connection</a>, this
              function MUST return a snapshot of the list of names of the <a title="object store">object
              stores</a> taken at the time when the
              <a href="#widl-IDBDatabaseSync-close-void"><code>close</code></a> method was called. Even if
              other <a title="connection">connections</a> are later used to change the set of <a title="object store">object
              stores</a> that exist in the <a>database</a>. In other words, the return
              value from this function stays constant for the lifetime of the
              <a>IDBDatabaseSync</a> instance except during a <a><code>"versionchange"</code></a>
              transaction if
              <a href="#widl-IDBDatabaseSync-createObjectStore-IDBObjectStoreSync-DOMString-name-IDBObjectStoreParameters-optionalParameters"><code>createObjectStore</code></a>
              or <a href="#widl-IDBDatabaseSync-deleteObjectStore-void-DOMString-name"><code>deleteObjectStore</code></a>
              is called on this <a>IDBDatabaseSync</a> instance itself.
            </dd>
            <dt>IDBObjectStoreSync createObjectStore()</dt>
            <dd>
              <p>
                This method creates and returns a new <a>object store</a> with the
                given name in the <a title="connection">connected</a> <a>database</a>.
                Note that this
                method must only be called from a <a><code>"versionchange"</code></a>
                <a>transaction</a> callback.
              </p>
              <p>
                If this method was not called from a <a><code>"versionchange"</code></a> <a>transaction</a> callback,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>InvalidStateError</code></a>.
              </p>
              <p>
                This method synchronously modifies the
                <a href="#widl-IDBDatabaseSync-objectStoreNames"><code>IDBDatabaseSync.objectStoreNames</code></a> property. However it
                only modifies the <a href="#widl-IDBDatabaseSync-objectStoreNames"><code>IDBDatabaseSync.objectStoreNames</code></a>
                property on the <a>IDBDatabaseSync</a> instance on which it was called.
              </p>
              <p>
                If the <var>optionalParameters</var> argument is specified and has a <code>keyPath</code> property
                which is not <code>null</code>, then set <var>keyPath</var> to the value
                of this property.
              </p>
              <p>
                If <var>keyPath</var> is not a <a>valid key path</a>,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>SyntaxError</code></a>.

                Otherwise set the created <a>object store</a>'s <a title="object store key path">key path</a> to the value of
                <var>keyPath</var>.
              </p>
              <p>
                If an <a>object store</a> with the same name, compared in a case-sensitive
                manner, already exists in the <a title="connection">connected</a> <a>database</a>,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>ConstraintError</code></a>.
              </p>
              <p>
                If the <var>optionalParameters</var> parameter is specified, and <code>autoIncrement</code> is set to true, and
                <code>keyPath</code> is an empty <code>DOMString</code> or any <code>sequence&lt;DOMString&gt;</code>,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>InvalidAccessError</code></a>.
              </p>
              <dl class="parameters">
                <dt>DOMString name</dt>
                  <dd>The <a title="object store name">name</a> of a new <a>object store</a></dd>
                <dt>optional IDBObjectStoreParameters optionalParameters</dt>
                  <dd>The <a>options object</a> whose attributes are optional parameters to this function.
                    <code>keyPath</code> specifies the <a title="object store key path">key path</a> of the new
                    <a>object store</a>. If the attribute is <code>null</code> no <a title="object store key path">key path</a> is
                    specified and thus keys are <a title="out-of-line keys">out-of-line</a>.
                    <code>autoIncrement</code> specifies
                    whether the <a>object store</a> created should have a <a>key generator</a>.</dd>
              </dl>
            </dd>
            <dt>void deleteObjectStore()</dt>
            <dd>
              <p>
                This method destroys an <a>object store</a> with the
                given name as well as all <a title="index">indexes</a> that are
                <a title="referenced">referencing</a> that <a>object store</a>.
                Note that this
                method must only be called from a <a><code>"versionchange"</code></a>
                <a>transaction</a> callback.
              </p>
              <p>
                This method synchronously modifies the
                <a href="#widl-IDBDatabaseSync-objectStoreNames"><code>IDBDatabaseSync.objectStoreNames</code></a> property. However it
                only modifies the <a href="#widl-IDBDatabaseSync-objectStoreNames"><code>IDBDatabaseSync.objectStoreNames</code></a>
                property on the <a>IDBDatabaseSync</a> instance on which it was called.
              </p>

              <dl class="parameters">
                <dt>DOMString name</dt>
                <dd>The <a title="object store name">name</a> of an existing
                <a>object store</a></dd>
              </dl>
              <p>
                If this method was not called from a <a><code>"versionchange"</code></a> <a>transaction</a> callback,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>InvalidStateError</code></a>.

                If the <a>object store</a> with the given name, compared in a case-sensitive manner, does not already exists
                in the <a title="connection">connected</a> <a>database</a>,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>NotFoundError</code></a>.
              </p>
            </dd>
            <dt>void transaction()</dt>
            <dd>
              <p>
                This method, when called MUST execute the
                <a title="create a transaction">steps for creating a transaction</a> in a sychronous
                fashion. The <var>storeNames</var>, <var>callback</var>, <var>mode</var>, and
                <var>timeout</var> arguments are forwarded to the algorithm as-is. The <var>connection</var>
                argument is set to the <a>IDBDatabaseSync</a> that the <code>transaction()</code> method was
                called on.
              </p>
              <p>
                The method returns an <a>IDBTransactionSync</a> object representing the <a>transaction</a>
                returned by the steps above.
              </p>
              <p>
                If the value for the <var>mode</var> parameter is not <code>"readonly"</code> or <code>"readwrite"</code>,
                the implementation MUST throw a <code>TypeError</code>.
              </p>
              <p>
                If this method is called within the <a>IDBTransactionCallback</a> of a <code>transaction</code> method or the
                <a>IDBVersionChangeCallback</a> of a <code>open</code> method,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>InvalidStateError</code></a>.
              </p>
              <dl class="parameters">
                <dt>(DOMString or sequence&lt;DOMString&gt;) storeNames</dt>
                <dd>The names of <a title="object store">object stores</a> in the <a>scope</a> of the new
                  <a>transaction</a></dd>
                <dt>IDBTransactionCallback callback</dt>
                <dd>A callback which will be called with the newly created transaction. When the callback returns,
                  the transaction is committed.</dd>
                <dt>optional IDBTransactionMode mode = "readonly"</dt>
                <dd>
                    The <a>mode</a> for isolating access to data inside the given
                    <a title="object store">object stores</a>. If this parameter is not provided, the default
                    access <a>mode</a> is <code>"readonly"</code>.
                </dd>
                <dt>optional unsigned long timeout</dt>
                <dd>The interval in milliseconds which this operation is allowed to
                take to reserve all the <a>database</a> objects identified in the new
                <a title="transaction">transaction's</a> <a>scope</a>. The default
                is user agent specific</dd>
              </dl>
              <p>
                If <a title="transaction start">starting</a> the transaction takes longer than the specified timeout,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>TimeoutError</code></a>.

                If the <code>close()</code> method has been called on this <a>IDBDatabase</a> instance,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>InvalidStateError</code></a>.

                If any of the names provided in the <var>storeNames</var> argument do not exist in this <a>database</a>,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>NotFoundError</code></a>.

                If <var>storeNames</var> is an empty list,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>InvalidAccessError</code></a>.
              </p>
            </dd>
            <dt>void close()</dt>
            <dd>
                This method synchronously performs the <a>steps for closing a database connection</a> and returns once
                the database has been closed.
            </dd>
          </dl>
        </section>
        <section class="section">
          <dl title='[NoInterfaceObject, Callback] interface IDBTransactionCallback' class='idl'>
            <dt>void transactionStarted()</dt>
            <dd>
              Called once the transaction is allowed to run. The actions taken in this function make up
              the body of the transaction.
              <dl class="parameters">
                <dt>IDBTransactionSync transaction</dt>
                <dd>The newly started transaction</dd>
              </dl>
            </dd>
          </dl>
        </section>
        <section class="section" id="versionchange-callback">
          <dl title='[NoInterfaceObject, Callback] interface IDBVersionChangeCallback' class='idl'>
            <dt>void transactionStarted()</dt>
            <dd>
              Called if a database upgrade is needed once the transaction used to upgrade the database is allowed to run.
              The actions taken in this function make up the body of the transaction.
              <dl class="parameters">
                <dt>IDBTransactionSync transaction</dt>
                <dd>The newly started transaction</dd>
                <dt>unsigned long long oldVersion</dt>
                <dd>The version that the database had before the upgrade was needed. 0 if the database was newly created.</dd>
              </dl>
            </dd>
          </dl>
        </section>
        <section class="section" id="object-store-sync">
          <h4>Object Store</h4>
          <aside class="example">
            <p>
              In the following example, we set up an <a>object store</a> to use the
              <a title="object store key path">key path</a> <em>id</em>. This
              <a>object store</a> is also designed to use a <a>key generator</a>.
            </p>
            <pre class="example highlight">var db = indexedDBSync.open('AddressBook', 1, function(trans, oldVersion) {
    trans.db.createObjectStore('Contact', {keyPath:'id', autoIncrement:true} );
});
            </pre>
            <p>
              Using this <a>database</a>, we can store records in the <em>Contact</em>
              <a>object store</a>.
            </p>
            <pre class="example highlight">var tx = db.transaction();
var store = tx.objectStore('Contact');
var contact = store.add({name: 'Lincoln', number: '7012'});
// contact.id === 1
            </pre>
            <p>
              A stored value can be retrieved using the same key used by the
              first put operation.
            </p>
            <pre class="example highlight">var contact = store.get(1);
// contact.name === 'Lincoln'</pre>
            <p>
              A put operation will overwrite the record stored by the first
              add operation with the same <a>key</a>.
            </p>
            <pre class="example highlight">var abraham = {id: 1, name: 'Abraham', number: '2107'};
store.put(abraham);</pre>
            <p>
              Now when the object store is read with the same key, the result
              is different compared to the object read earlier.
            </p>
            <pre class="example highlight">var contact = store.get(1);
// contact.id === 1 &amp;&amp; contact.name === 'Abraham';</pre>
            <p>
              Additionally, all the <a title="record">records</a> of an <a>object store</a>
              matching a certain <a>key range</a> can be retrieved in key order.
            </p>
            <pre class="example highlight">var range = new IDBKeyRange.bound(2, 4);
var cursor = store.openCursor(range);
// each value is a contact and each key is the id for that
// contact whose id is between 2 and 4, both inclusive
cursor.continue();</pre>
          </aside>

          <dl class="idl" title="interface IDBObjectStoreSync">
            <dt>readonly attribute DOMString name</dt>
            <dd>
              On getting, provide the <a title="object store name">name</a> of this
              object store.
            </dd>
            <dt>readonly attribute any keyPath</dt>
            <dd>
              <p>
                On getting, returns a value representing the <a title="object store key path">key path</a>
                of this <a>object store</a>, or <code>null</code> if none.

                If the <a>key path</a> is a <code>DOMString</code>,
                the value will be a <code>DOMString</code> equal to the key path.

                If the <a>key path</a> is a <code>sequence&lt;DOMString&gt;</code>,
                the value will be a new <code>Array</code>, populated by appending
                <code>String</code>s equal to each <code>DOMString</code> in the sequence.
              </p>
              <p>
                The returned value is not the same instance that was used when the <a>object store</a>
                was created. However, if this attribute returns an object (specifically an <code>Array</code>),
                it returns the same object instance every time it is inspected. Changing
                the properties of the object has no effect on the <a>object store</a>.
              </p>
            </dd>
            <dt>readonly attribute DOMStringList  indexNames</dt>
            <dd>
              <p>
                On getting, provide a list of the names of <a title="index">indexes</a> on
                objects in this <a>object store</a>. The list MUST
                be sorted in ascending order using the algorithm defined by step 4
                of <cite>section 11.8.5, The Abstract Relational Comparison Algorithm</cite>
                of the ECMAScript Language Specification [[!ECMA-262]].
              </p>
              <p>
                Once the <a>closePending</a> flag is set on the <a>connection</a>, this
                function MUST return a snapshot of the list of names of the
                <a title="index">indexes</a> taken at the time when the
                <a href="#widl-IDBDatabaseSync-close-void"><code>close</code></a> method was called. Even if
                other <a title="connection">connections</a> are later used to change the set of
                <a title="index">indexes</a> that exist in the <a>object store</a>. In other words, the return
                value from this function stays constant for the lifetime of the
                <a>IDBObjectStoreSync</a> instance, except during a <a><code>"versionchange"</code></a>
                transaction if
                <a href="#widl-IDBObjectStoreSync-createIndex-IDBIndexSync-DOMString-name-DOMString-sequence-DOMString--keyPath-IDBIndexParameters-optionalParameters"><code>createIndex</code></a>
                or
                <a href="#widl-IDBObjectStoreSync-deleteIndex-void-DOMString-indexName"><code>deleteIndex</code></a>
                is called on this <a>IDBObjectStoreSync</a> instance itself.
              </p>
            </dd>
            <dt>readonly attribute IDBTransactionSync transaction</dt>
            <dd>
              On getting, returns the <a>transaction</a> this <a>object store</a> belongs to.
            </dd>
            <dt>readonly attribute boolean autoIncrement</dt>
            <dd>On getting, provides the auto increment flag for this <a>object store</a>.</dd>


            <dt>any put()</dt>
            <dd>
              <p>
                If the transaction which this <a>IDBObjectStoreSync</a> belongs to has its <a>mode</a> set to <code>"readonly"</code>,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>ReadOnlyError</code></a> 

                If the <a>transaction</a> this <a>IDBObjectStoreSync</a> belongs to is not <a>active</a>,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>TransactionInactiveError</code></a>.

                If this <a>object store</a> has been deleted,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>InvalidStateError</code></a>.

                If any of the following conditions are true,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>DataError</code></a>:
              </p>
              <ul>
                <li>
                  The object store uses <a>in-line keys</a> and
                  the <var>key</var> parameter was provided.
                </li>
                <li>
                  The object store uses <a>out-of-line keys</a> and has no <a>key generator</a>
                  and the <var>key</var> parameter was not provided.
                </li>
                <li>
                  The object store uses <a>in-line keys</a>
                  and the result of <a title="evaluate key path">evaluating</a> the
                  <a title="object store key path">object store's key path</a> yields a value and
                  that value is not a <a>valid key</a>.
                </li>
                <li>
                  The object store uses <a>in-line keys</a> but no <a>key generator</a>
                  and the result of <a title="evaluate key path">evaluating</a> the
                  <a title="object store key path">object store's key path</a> does not yield a value.
                </li>
                <li>
                  The <var>key</var> parameter was provided but does not contain a <a>valid key</a>.
                </li>
              </ul>
              <p>
                Otherwise this method creates a <a>structured clone</a> of the <var>value</var> parameter.
                If the <a>structured clone</a> algorithm throws an exception, that exception is rethrown.
                Otherwise, run the <a>steps for synchronously executing a request</a> and return the result,
                in this case the <a>key</a> of the stored object.
                The steps are run with this <a>IDBObjectStoreSync</a> as <var>source</var> and the <a>steps for
                storing a record into an object store</a> as <var>operation</var>, using this <a>IDBObjectStoreSync</a>
                as <var>store</var>, the created clone as <var>value</var>, the <var>key</var> parameter as
                <var>key</var>, and with the <var>no-overwrite flag</var> flag set to false.
              </p>
              <dl class="parameters">
                <dt>any value</dt>
                <dd>The value to be stored in the record</dd>
                <dt>optional any key</dt>
                <dd>The key used to identify the record</dd>
              </dl>
            </dd>
            <dt>any add()</dt>
            <dd>
              <p>
                If the transaction which this <a>IDBObjectStoreSync</a> belongs to has its <a>mode</a> set to <code>"readonly"</code>,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>ReadOnlyError</code></a> 

                If the <a>transaction</a> this <a>IDBObjectStoreSync</a> belongs to is not <a>active</a>,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>TransactionInactiveError</code></a>.

                If this <a>object store</a> has been deleted,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>InvalidStateError</code></a>.

                If any of the following conditions are true,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>DataError</code></a>:
              </p>
              <ul>
                <li>
                  The object store uses <a>in-line keys</a> and
                  the <var>key</var> parameter was provided.
                </li>
                <li>
                  The object store uses <a>out-of-line keys</a> and has no <a>key generator</a>
                  and the <var>key</var> parameter was not provided.
                </li>
                <li>
                  The object store uses <a>in-line keys</a>
                  and the result of <a title="evaluate key path">evaluating</a> the
                  <a title="object store key path">object store's key path</a> yields a value and
                  that value is not a <a>valid key</a>.
                </li>
                <li>
                  The object store uses <a>in-line keys</a> but no <a>key generator</a>
                  and the result of <a title="evaluate key path">evaluating</a> the
                  <a title="object store key path">object store's key path</a> does not yield a value.
                </li>
                <li>
                  The <var>key</var> parameter was provided but does not contain a <a>valid key</a>.
                </li>
              </ul>
              <p>
                Otherwise this method creates a <a>structured clone</a> of the <var>value</var> parameter.
                If the <a>structured clone</a> algorithm throws an exception, that exception is rethrown.
                Otherwise, run the <a>steps for synchronously executing a request</a> and return the <a>key</a> of the stored object.
                The steps are run with this <a>IDBObjectStoreSync</a> as <var>source</var> and the <a>steps for
                storing a record into an object store</a> as <var>operation</var>, using this <a>IDBObjectStoreSync</a>
                as <var>store</var>, the created clone as <var>value</var>, the <var>key</var> parameter as
                <var>key</var>, and with the <var>no-overwrite flag</var> flag set to true.
              </p>
              <dl class="parameters">
                <dt>any value</dt>
                <dd>The value to be stored in the record</dd>
                <dt>optional any key</dt>
                <dd>The key used to identify the record</dd>
              </dl>
            </dd>
            <dt>boolean delete()</dt>
            <dd>
              <p>
                If the transaction which this <a>IDBObjectStoreSync</a> belongs to has its <a>mode</a> set to <code>"readonly"</code>,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>ReadOnlyError</code></a> 

                If the <a>transaction</a> this <a>IDBObjectStoreSync</a> belongs to is not <a>active</a>,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>TransactionInactiveError</code></a>.

                If this <a>object store</a> has been deleted,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>InvalidStateError</code></a>.

                If the <var>key</var> parameter is not a <a>valid key</a> or a <a>key range</a>,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>DataError</code></a>.
              </p>
              <p>
                Otherwise this method runs the <a>steps for synchronously executing a request</a>.
                The steps are run with this <a>IDBObjectStoreSync</a> as <var>source</var> and the <a>steps for deleting
                records from an object store</a> as <var>operation</var>, using this <a>IDBObjectStoreSync</a>
                as <var>store</var> and the <var>key</var> parameter as <var>key</var>. The function returns the result
                of running these steps.
              </p>
              <p class="note">
                Unlike other methods which take keys or key ranges, this method does <strong>not</strong> allow null to
                be passed as key. This is to reduce the risk that a small bug would clear a whole object store.
              </p>
              <dl class="parameters">
                <dt>any key</dt>
                <dd>Key identifying the record to be deleted</dd>
              </dl>
            </dd>
            <dt>any get()</dt>
            <dd>
              <p>
                If the <a>transaction</a> this <a>IDBObjectStoreSync</a> belongs to is not <a>active</a>,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>TransactionInactiveError</code></a>.

                If this <a>object store</a> has been deleted,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>InvalidStateError</code></a>.

                If the <var>key</var> parameter is not a <a>valid key</a> or a <a>key range</a>,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>DataError</code></a>.
              </p>
              <p>
                Otherwise, this method runs the <a>steps for synchronously executing
                a request</a> and returns the result of the operation. The steps are run with this
                <a>IDBObjectStoreSync</a> as <var>source</var> and the <a>steps for retrieving a value from an
                object store</a> as <var>operation</var>, using this <a>IDBObjectStoreSync</a> as <var>store</var> and the
                <var>key</var> parameter as <var>key</var>.
              </p>
              <p class="note">
                This function produces the same result if a record with the given key doesn't exist as when a record
                exists, but has <code>undefined</code> as value. If you need to tell the two situations apart, you can use
                <a href="#widl-IDBObjectStoreSync-openCursor-IDBCursorWithValueSync-any-range-IDBCursorDirection-direction"><code>openCursor</code></a> with the same key. This will return a cursor with
                <code>undefined</code> as value if a record exists, or no cursor if no such record exists.
              </p>
              <dl class="parameters">
                <dt>any key</dt>
                <dd>Key identifying the <a>record</a> to be retrieved. This can also be an <a>IDBKeyRange</a> in which case
                the function retrieves the first existing value in that range.</dd>
              </dl>
            </dd>
            <dt>void clear()</dt>
            <dd>
              <p>
                If the transaction which this <a>IDBObjectStoreSync</a> belongs to has its <a>mode</a> set to <code>"readonly"</code>,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>ReadOnlyError</code></a> 

                If the <a>transaction</a> this <a>IDBObjectStoreSync</a> belongs to is not <a>active</a>,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>TransactionInactiveError</code></a>.

                If this <a>object store</a> has been deleted,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>InvalidStateError</code></a>.
              </p>
              <p>
                Otherwise this method runs the <a>steps for synchronously executing a request</a>. The steps
                are run with this <a>IDBObjectStoreSync</a> as <var>source</var> and the
                <a>steps for clearing an object store</a> as <var>operation</var>, using
                this <a>IDBObjectStoreSync</a> as <var>store</var>.
              </p>
            </dd>
            <dt>IDBIndexSync createIndex()</dt>
            <dd>
              <p>
                This creates and returns a new <a>index</a> with the given name and parameters in the
                <a>object store</a>. The created index has its <a>unique</a> and <a>multiEntry</a> flags are set to the values of the
                <var>unique</var> and <var>multiEntry</var> properties in the <var>optionalParameters</var> argument.
              </p>
              <p>
                If this method was not called from a <a><code>"versionchange"</code></a> <a>transaction</a>,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>InvalidStateError</code></a>.

                If this <a>object store</a> has been deleted,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>InvalidStateError</code></a>.
               </p>
              <p>
                If <var>keyPath</var> is not a <a>valid key path</a>,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>SyntaxError</code></a>.

                If <var>keyPath</var> is a <code>sequence&lt;DOMString&gt;</code> and the <var>multiEntry</var> property in the <var>optionalParameters</var> is true,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>InvalidAccessError</code></a>.

                Otherwise set the created <a>index</a>'s
                <a title="index key path">key path</a> to the value of <var>keyPath</var>.
              </p>
              <dl class="parameters">
                <dt>DOMString name</dt>
                  <dd>The <a title="index name">name</a> of a new <a>index</a></dd>
                <dt>(DOMString or sequence&lt;DOMString&gt;) keyPath</dt>
                  <dd>The <a title="index key path">key path</a> used by the new
                  <a>index</a></dd>
                <dt>optional IDBIndexParameters optionalParameters</dt>
                  <dd>The <a>options object</a> whose attributes are optional parameters to this function.
                    <code>unique</code> specifies whether the <a>index</a>'s <a>unique</a> flag is
                    set.
                    <code>multiEntry</code> specifies whether the <a>index</a>'s <a>multiEntry</a> flag is
                    set.
                  </dd>
              </dl>
              <p>
                If an <a>index</a> with the same name, compared in a case-sensitive manner, already exists in the <a>object store</a>,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>ConstraintError</code></a>.

                If <var>unique</var> is true and the <a>object store</a> contains records that violate the unique constraint,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>ConstraintError</code></a>.
              </p>
            </dd>
            <dt>IDBIndexSync index()</dt>
            <dd>
              Returns an <a>IDBIndexSync</a> representing an <a>index</a> that is part of the
              <a>object store</a>. Every call to this function on the same
              <a>IDBObjectStoreSync</a> instance and with the same <var>name</var> returns the same <a>IDBIndexSync</a> instance.
              However the retured <a>IDBIndexSync</a> instance is specific to this <a>IDBObjectStoreSync</a> instance. If this
              function is called on a different <a>IDBObjectStoreSync</a> instance, a different <a>IDBIndexSync</a> instance is
              returned. A result of this is that different <a>IDBTransactionSync</a> instances use different <a>IDBIndexSync</a> instances
              to represent the same <a>index</a>.
              <dl class="parameters">
                <dt>DOMString name</dt>
                <dd>The <a title="index name">name</a> of an existing <a>index</a></dd>
              </dl>
              <p>
                If the <a>index</a> with the given name does not exist in the <a>object store</a>,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>NotFoundError</code></a>.

                If this <a>object store</a> has been deleted,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>InvalidStateError</code></a>.

                If the <a>transaction</a> this <a>object store</a> belongs to has finished,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>InvalidStateError</code></a>.
              </p>
            </dd>
            <dt>void deleteIndex()</dt>
            <dd>
              <p>
                This method destroys the <a>index</a> with the given name in the
                <a>object store</a>.
                </p>
              <p>
                If this method was not called from a <a><code>"versionchange"</code></a> <a>transaction</a>,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>InvalidStateError</code></a>.
              </p>
              <dl class="parameters">
                <dt>DOMString indexName</dt>
                <dd>The <a title="index name">name</a> of an existing <a>index</a></dd>
              </dl>
              <p>
                If the <a>index</a> with the given name does not exist in the <a>object store</a>,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>NotFoundError</code></a>.
              </p>
            </dd>
            <dt>IDBCursorWithValueSync openCursor()</dt>
            <dd>
              <p>
                If the <var>range</var> parameter is specified but is not a <a>valid key</a> or a <a>key range</a>,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>DataError</code></a>.

                Otherwise, this method creates a <a>cursor</a>. The cursor
                MUST implement the <a>IDBCursorWithValueSync</a> interface.
              </p>
              <p>
                The newly created cursor MUST have an undefined <a>position</a>, a <a>direction</a> set to the value
                of the <var>direction</var> parameter, false as <a>got value</a> flag value, and undefined
                <a title="cursor key">key</a> and <a title="cursor value">value</a>. The <a title="cursor source">source</a>
                of the cursor is the <a>IDBObjectStoreSync</a> this function was called on.
              </p>
              <p>
                If the <var>range</var> parameter is a <a>key range</a> then the cursor's <a>range</a> is set to that
                range. Otherwise, if the <var>range</var> parameter is a <a>valid key</a> then the cursor's <a>range</a>
                is set to <a>key range</a> containing only that key value. If the <var>range</var> parameter is not specified,
                the cursor's key range is left as undefined.
              </p>
              <p>
                This method runs the <a>steps for synchronously executing a request</a> and returns the result of the operation, in
                this case an <a>IDBCursorSync</a> object. The steps are run with this <a>IDBObjectStoreSync</a> as <var>source</var> and the
                <a>steps for iterating a cursor</a> as <var>operation</var>,
                using the created cursor as <var>cursor</var> and with undefined as <var>key</var>.
              </p>
              <dl class="parameters">
                <dt>optional any? range</dt>
                <dd>The <a>key range</a> to use as the <a>cursor</a>'s <a>range</a></dd>
                <dt>optional IDBCursorDirection direction = "next"</dt>
                <dd>The <a>cursor</a>'s required <a>direction</a></dd>
              </dl>
              <p>
                If the <a>transaction</a> this <a>IDBObjectStoreSync</a> belongs to is not <a>active</a>,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>TransactionInactiveError</code></a>.

                If the <a>object store</a> has been deleted,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>InvalidStateError</code></a>.
              </p>
            </dd>
            <dt>unsigned long count()</dt>
            <dd>
              <p>
                If the optional <var>key</var> parameter is not a <a>valid key</a> or a <a>key range</a>,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>DataError</code></a>.
              </p>
              <p>
                This method runs the <a>steps for asynchronously executing a request</a> and returns the <a>IDBRequest</a> created by these steps.
                The steps are run with this <a>IDBObjectStore</a> as <var>source</var> and the <a>steps for iterating a cursor</a> as <var>operation</var>,
                using the created cursor as <var>cursor</var>.
                If provided, use the <var>key</var> parameter as <var>key</var>, otherwise, use undefined as <var>key</var>.
                If the result of the algorithm is <strong>null</strong> return <code>0</code> (zero) as the result for the request.
                Otherwise, use the return <a>cursor</a> to determine the total number of objects that share the
                <a>key</a> or <a>key range</a> and return that value as the result for the request.
              </p>
              <dl class="parameters">
                <dt>optional any key</dt>
                <dd>
                  Key identifying the record to be retrieved.
                  This can also be an <a>IDBKeyRange</a>.
                </dd>
              </dl>
              <p>
                If the <a>transaction</a> this <a>IDBObjectStoreSync</a> belongs to is not <a>active</a>,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>TransactionInactiveError</code></a>.

                If the <a>object store</a> has been deleted,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>InvalidStateError</code></a>.
              </p>
            </dd>
          </dl>
        </section>
        <section id="index-sync" class="section">
          <h4>Index</h4>

          <aside class="example">
            <p>
              An <a>index</a> can be created for retrieving records other than
              by using record keys. Continuing the earlier example, an
              index could be maintained on the <em>name</em> property of objects
              in the <em>Contact</em> <a>object store</a>.
            </p>
            <pre class="example highlight">
var db = indexedDBSync.open('AddressBook', 2, function(trans, oldVersion) {
  if (oldVersion === 1) {
    trans.db.createObjectStore('Contact', {keyPath:'id', autoIncrement:true});
  }
  var store = trans.objectStore('Contact');
  store.createIndex('ContactName', 'name', {unique:false, multiEntry:false});
});
</pre>
            <p>
              For example, the <em>id</em> of an object with the <em>name</em>
              property value 'Lincoln' can be retrieved using the
              <em>ContactName</em> <a>index</a>.
            </p>
            <pre class="example highlight">
var index = store.<a>index</a>('ContactName');
var id = index.<a>get</a>('Lincoln');
// id === 1</pre>
            <p>
              Additionally, all the records of an <a>object store</a> matching
              a certain range index keys can be retrieved in key order. When
              objects are retrieved from the <em>Contact</em> <a>object store</a>,
              they are arranged by the value of the <em>id</em> attribute. On the
              other hand, when objects are retrieved using the <em>ContactName</em>
              <a>index</a>, they are arranged by the value of the <em>name</em>
              property.
            </p>
            <pre class="example highlight">var range = new <a>IDBKeyRange</a>.<a>bound</a>('L', 'M');
var cursor = index.<a>openCursor</a>(range);
// each value is a contact and each key is the name for that
// contact whose name's first letter is either L or M
cursor.<a>continue</a>();</pre>
            <p>
              If, on the other hand, we only want the names and keys but not the whole <em>Contact</em>
              objects for a given range, then we can use a different mechanism for that.
            </p>
            <pre class="example highlight">var range = new <a>IDBKeyRange</a>.<a>bound</a>('L', 'M');
var cursor = index.<a>openKeyCursor</a>(range);
// each value is a contact id and each key is the name for that
// contact whose name's first letter is either L or M
cursor.<a>continue</a>();</pre>
          </aside>

          <dl class="idl" title="interface IDBIndexSync">
            <dt>readonly attribute DOMString name</dt>
            <dd>
              On getting, provide the <a title="index name">name</a> of this <a>index</a>.
            </dd>
            <dt>readonly attribute IDBObjectStoreSync objectStore</dt>
            <dd>
              On getting, returns a reference to the <a>IDBObjectStoreSync</a> instance for the
              <a>referenced</a> object store in this <a>IDBIndexSync</a>'s transaction. This MUST
              return the same <a>IDBObjectStoreSync</a> instance as was used to get a reference
              to this <a>IDBIndexSync</a>.
            </dd>

            <dt>readonly attribute any keyPath</dt>
            <dd>
               <p>
                On getting, returns a value representing the <a title="index key path">key path</a>
                of this <a>index</a>.

                If the <a>key path</a> is a <code>DOMString</code>,
                the value will be a <code>DOMString</code> equal to the key path.

                If the <a>key path</a> is a <code>sequence&lt;DOMString&gt;</code>,
                the value will be a new <code>Array</code>, populated by appending
                <code>String</code>s equal to each <code>DOMString</code> in the sequence.
              </p>
              <p>
                The returned value is not the same instance that was used when the <a>index</a>
                was created. However, if this attribute returns an object (specifically an <code>Array</code>),
                it returns the same object instance every time it is inspected. Changing
                the properties of the object has no effect on the <a>index</a>.
              </p>
            </dd>

            <dt>readonly attribute boolean multiEntry</dt>
            <dd>
            	On getting, provide the <a>multiEntry</a> flag of this <a>index</a>.
            </dd>

            <dt>readonly attribute boolean unique</dt>
            <dd>
              On getting, provide the <a>unique</a> flag of this <a>index</a>.
            </dd>

            <dt>IDBCursorWithValueSync openCursor()</dt>
            <dd>
              <p>
                If the <var>range</var> parameter is specified but is not a <a>valid key</a> or a <a>key range</a>,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>DataError</code></a>.

                Otherwise, this method creates a <a>cursor</a>. The cursor
                MUST implement the <a>IDBCursorWithValueSync</a> interface.
              </p>
              <p>
                The newly created cursor MUST have an undefined <a>position</a>, a <a>direction</a> set to the value
                of the <var>direction</var> parameter, false as <a>got value</a> flag value, and undefined
                <a title="cursor key">key</a> and <a title="cursor value">value</a>. The <a title="cursor source">source</a>
                of the cursor is the <a>IDBIndexSync</a> this function was called on.
              </p>
              <p>
                If the <var>range</var> parameter is a <a>key range</a> then the cursor's <a>range</a> is set to that
                range. Otherwise, if the <var>range</var> parameter is a <a>valid key</a> then the cursor's <a>range</a>
                is set to <a>key range</a> containing only that key value. If the <var>range</var> parameter is not specified,
                the cursor's key range is left as undefined.
              </p>
              <p>
                This method runs the <a>steps for synchronously executing
                a request</a> and returns the result, in this case a cursor object. The steps are run with this
                <a>IDBIndexSync</a> as <var>source</var> and the <a>steps for iterating a cursor</a> as <var>operation</var>,
                using the created cursor as <var>cursor</var> and with undefined as <var>key</var>
              </p>
              <dl class="parameters">
                <dt>optional any? range</dt>
                <dd>The <a>key range</a> to use as the <a>cursor</a>'s <a>range</a></dd>
                <dt>optional IDBCursorDirection direction = "next"</dt>
                <dd>The <a>cursor</a>'s required <a>direction</a></dd>
              </dl>
              <p>
                If the <a>transaction</a> this <a>IDBIndexSync</a> belongs to is not <a>active</a>,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>TransactionInactiveError</code></a>.

                If the <a>index</a> has been deleted,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>InvalidStateError</code></a>.
              </p>
            </dd>

            <dt>IDBCursorSync openKeyCursor()</dt>
            <dd>
              <p>
                If the <var>range</var> parameter is specified but is not a <a>valid key</a> or a <a>key range</a>,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>DataError</code></a>.

                Otherwise, this method creates a <a>cursor</a>. The cursor
                MUST implement the <a>IDBCursorSync</a> interface and MUST NOT implement the <a>IDBCursorWithValueSync</a>
                interface.
              </p>
              <p>
                The newly created cursor MUST have an undefined <a>position</a>, a <a>direction</a> set to the value
                of the <var>direction</var> parameter, false as <a>got value</a> flag value, and undefined
                <a title="cursor key">key</a> and <a title="cursor value">value</a>. The <a title="cursor source">source</a>
                of the cursor is the <a>IDBIndexSync</a> this function was called on.
              </p>
              <p>
                If the <var>range</var> parameter is a <a>key range</a> then the cursor's <a>range</a> is set to that
                range. Otherwise, if the <var>range</var> parameter is a <a>valid key</a> then the cursor's <a>range</a>
                is set to <a>key range</a> containing only that key value. If the <var>range</var> parameter is not specified,
                the cursor's key range is left as undefined.
              </p>
              <p>
                This method runs the <a>steps for synchronously executing
                a request</a> and returns the result, in this case a cursor object. The steps are run with this
                <a>IDBIndexSync</a> as <var>source</var> and the <a>steps for iterating a cursor</a> as <var>operation</var>,
                using the created cursor as <var>cursor</var> and with undefined as <var>key</var>
              </p>
              <dl class="parameters">
                <dt>optional any? range</dt>
                <dd>The <a>key range</a> to use as the <a>cursor</a>'s <a>range</a></dd>
                <dt>optional IDBCursorDirection direction = "next"</dt>
                <dd>The <a>cursor</a>'s required <a>direction</a></dd>
              </dl>
              <p>
                If the <a>transaction</a> this <a>IDBIndexSync</a> belongs to is not <a>active</a>,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>TransactionInactiveError</code></a>.

                If the <a>index</a> has been deleted,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>InvalidStateError</code></a>.
              </p>
            </dd>
            <dt>any get()</dt>
            <dd>
              <p>
                If the <var>key</var> parameter is not a <a>valid key</a> or a <a>key range</a>,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>DataError</code></a>.

                This method runs the <a>steps for synchronously executing a request</a>
                and returns the result from that, in this case an object from the underlying store. The steps are
                run with this <a>IDBIndexSync</a> as <var>source</var> and the <a>steps
                for retrieving a referenced value from an index</a> as <var>operation</var>, using this <a>IDBIndexSync</a>
                as <var>index</var> and the <var>key</var> parameter as <var>key</var>.
              </p>
              <p class="note">
                This function produces the same result if a record with the given key doesn't exist as when a record
                exists, but has <code>undefined</code> as value. If you need to tell the two situations apart, you can use
                <a href="#widl-IDBIndexSync-openCursor-IDBCursorWithValueSync-any-range-IDBCursorDirection-direction"><code>openCursor</code></a> with the same key. This will return a cursor with
                <code>undefined</code> as value if a record exists, or no cursor if no such record exists.
              </p>
              <dl class="parameters">
                <dt>any key</dt>
                <dd>Key identifying the record to be retrieved. This can also be an <a>IDBKeyRange</a> in which case
                the function retreives the first existing value in that range.</dd>
              </dl>
              <p>
                If the <a>transaction</a> this <a>IDBIndexSync</a> belongs to is not <a>active</a>,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>TransactionInactiveError</code></a>.

                If the <a>index</a> has been deleted,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>InvalidStateError</code></a>.
              </p>
            </dd>
            <dt>any getKey()</dt>
            <dd>
              <p>
                If the <var>key</var> parameter is not a <a>valid key</a> or a <a>key range</a>,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>DataError</code></a>.

                This method runs the <a>steps for synchronously executing a request</a>
                and returns the result from that, in this case an index value (a <a>key</a>). The steps are
                run with the <a>IDBObjectStoreSync</a> associated with this index as <var>source</var> and the <a>steps
                for retrieving a value from an index</a> as <var>operation</var>, using this <a>IDBIndexSync</a>
                as <var>index</var> and the <var>key</var> parameter as <var>key</var>.
              </p>
              <dl class="parameters">
                <dt>any key</dt>
                <dd>Key identifying the record to be retrieved. This can also be an <a>IDBKeyRange</a> in which case
                the function retreives the first existing value in that range.</dd>
              </dl>
              <p>
                If the <a>transaction</a> this <a>IDBIndexSync</a> belongs to is not <a>active</a>,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>TransactionInactiveError</code></a>.

                If the <a>index</a> has been deleted,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>InvalidStateError</code></a>.
              </p>
            </dd>
            <dt>unsigned long count()</dt>
            <dd>
              <p>
                If the optional <var>key</var> parameter is not a <a>valid key</a> or a <a>key range</a>,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>DataError</code></a>.

                This method runs the <a>steps for asynchronously executing a request</a> and returns the <a>IDBRequest</a> created by these steps.
                The steps are run with this <a>IDBIndex</a> as <var>source</var> and the <a>steps for iterating a cursor</a> as <var>operation</var>,
                using the created cursor as <var>cursor</var>.
                If provided, use the <var>key</var> parameter as <var>key</var>, otherwise, use undefined as <var>key</var>.
                If the result of the algorithm is <strong>null</strong> return <code>0</code> (zero) as the result for the request.
                Otherwise, use the return <a>cursor</a> to determine the total number of objects that share the
                <a>key</a> or <a>key range</a> and return that value as the result for the request.
              </p>
              <dl class="parameters">
                <dt>optional any key</dt>
                <dd>
                  Key identifying the record to be retrieved.
                  This can also be an <a>IDBKeyRange</a>.
                </dd>
              </dl>
              <p>
                If the <a>transaction</a> this <a>IDBIndexSync</a> belongs to is not <a>active</a>,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>TransactionInactiveError</code></a>.

                If the <a>index</a> has been deleted,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>InvalidStateError</code></a>.
              </p>
            </dd>
          </dl>
        </section>
        <section class="section" id="cursor-sync">
          <h4>Cursor</h4>
          <p>
            Using the synchronous API, an application can process all the records
            in the <a>cursor</a>'s <a>range</a>.
          </p>
          <aside class="example">
            <p>
              By default, a <a>cursor</a> walks over objects starting at the
              first record and ending at the last record including
              all the duplicates encountered along the way.
            </p>
            <pre class="example highlight">var tx = db.<a>transaction</a>('Contact');
var store = tx.<a>objectStore</a>('Contact');
var cursor = store.<a>openCursor</a>();
while(cursor.<a>continue</a>()) {
    var value = cursor.value;
    // act on each object or key
}
</pre>

            <p>
              To start at the last record and end in the first record, the cursor
              should be created with the direction parameter <code>"prev"</code>.
            </p>
            <pre class="example highlight">var cursor = store.<a>openCursor</a>("prev");
while(cursor.<a>continue</a>()) {
    // act on each object or key
}
</pre>

            <p>
              To start at a certain key and end in the last record, i.e.,
              for a lower-bounded cursor, while skipping duplicates,
              the cursor should be created with both the required
              start key and the direction parameter.
            </p>

            <pre class="example highlight">var range = <a>IDBKeyRange</a>.leftBound(key);
var cursor = store.<a>openCursor</a>(range, "nextunique");
</pre>

            <p>
              It is also possible to create a bounded cursor, i.e., with
              application-specified starting and ending points, the
              cursor should be created with both the required keys.
              If the range is inclusive of both keys, then additional
              flags are required. In the following example, all keys
              with values in the inclusive range (<code>start</code>,
              <code>end</code>) are returned with all their duplicates,
              from the beginning of the range to its end.
            </p>

            <pre class="example highlight">var range = <a>IDBKeyRange</a>.bound(start, end);
var cursor = objects.<a>openCursor</a>(range);
</pre>
          </aside>
          <dl class="idl" title="interface IDBCursorSync">
            <dt>readonly attribute (IDBObjectStoreSync or IDBIndexSync) source</dt>
            <dd>
            On getting, returns the <a>IDBObjectStoreSync</a> or <a>IDBIndexSync</a> which this cursor is iterating. This function
            never returns null or throws an exception, even if the cursor is currently being iterated, has iterated past its end,
            or its transaction is not <a>active</a>.
            </dd>
            <dt>readonly attribute DOMString direction</dt>
            <dd>
            On getting, provide the traversal <a>direction</a> of the <a>cursor</a>.
            </dd>
            <dd>Returns the cursor's current <a title="cursor key">key</a>.
            Note that if this property returns an object (specifically an <code>Array</code>), it returns the same
            object instance every time it is inspected, until the cursor is iterated.
            This means that if the object is modified,
            those modifications will be seen by anyone inspecting the value of the cursor. However modifying such an object
            does not modify the contents of the database.</dd>
            <dt>readonly attribute any primaryKey</dt>
            <dd>Returns the cursor's current <a>effective key</a>.
            Note that if this property returns an object (specifically an <code>Array</code>), it returns the same
            object instance every time it is inspected, until the cursor is iterated.
            This means that if the object is modified,
            those modifications will be seen by anyone inspecting the value of the cursor. However modifying such an object
            does not modify the contents of the database.</dd>

            <dt>IDBRequest update()</dt>
            <dd>
              <p>
                If the transaction which this IDBCursorSync belongs to has its <a>mode</a> set to <code>"readonly"</code>,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>ReadOnlyError</code></a>

                If this cursor's <a>got value</a> flag is false, indicating the cursor is currently being iterated or has iterated past its end,
                or if this cursor does not implement the <a>IDBCursorWithValueSync</a> interface,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>InvalidStateError</code></a>.

                If the <a>effective object store</a> of this cursor uses <a>in-line keys</a>
                and <a title="evaluate key path">evaluating</a> the <a title="object store key path">key path</a>
                of the <var>value</var> parameter results in a different value than the cursor's <a>effective key</a>,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>DataError</code></a>.
              </p>
              <p>
                Otherwise this method creates a <a>structured clone</a> of the <var>value</var> parameter.
                If the <a>structured clone</a> algorithm throws an exception, that exception is rethrown.
                Otherwise, run the <a>steps for synchronously executing a request</a> and return the result returned by these steps.
                The steps are run with this IDBCursorSync as <var>source</var> and the <a>steps for
                storing a record into an object store</a> as <var>operation</var>, using this cursor's
                <a>effective object store</a> as <var>store</var>, the created clone as <var>value</var>,
                this cursor's <a>effective key</a> as <var>key</var>, and with the <var>no-overwrite flag</var>
                flag set to false.
              </p>
              <p class="note">
                A result of running the <a>steps for storing a record into an object store</a> is that if the record
                has been deleted since the cursor moved to it, a new record will be created.
              </p>
              <dl class="parameters">
                <dt>any value</dt>
                <dd>The new value to store at the current position.</dd>
              </dl>
              <p>
                If the <a>transaction</a> this <a>IDBCursorSync</a> belongs to is not <a>active</a>,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>TransactionInactiveError</code></a>.
              </p>
            </dd>

            <dt>boolean  advance()</dt>
            <dd>
              <p>
                If this cursor's <a>got value</a> flag is false, indicating the cursor is currently being iterated or has iterated past its end,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>InvalidStateError</code></a>.

                If the value for <var>count</var> is <code>0</code> (zero),
                the implementation MUST throw a <code>TypeError</code>.
              </p>
              <p>
                Otherwise, this method runs the <a>steps for synchronously executing a request</a>.
                The steps are run with the cursor's <a title="cursor source">source</a> as <var>source</var>.
                The <var>operation</var> runs the <a>steps for iterating a cursor</a> <var>count</var> number of times
                with null as <var>key</var> and this cursor as <var>cursor</var>. If the <a>steps for synchronously
                executing a request</a> returns a cursor, then this function returns <code>true</code>. Otherwise
                this function returns <code>false</code>.
              </p>
              <p>
                Before this method returns, unless an exception was thrown, it sets the <a>got value</a> flag in the cursor to false.
              </p>
              <p>
                Calling this method more than once before new cursor data has been loaded is not allowed
                and results in a <code>DOMException</code> of type <a><code>InvalidStateError</code></a> being thrown.
                For example, calling <code>advance()</code> twice from the same onsuccess handler
                results in a <code>DOMException</code> of type <a><code>InvalidStateError</code></a> being thrown on the second call.
              </p>
              <dl class="parameters">
                <dt>[EnforceRange] unsigned long count</dt>
                <dd>The number of advances forward the cursor should make.</dd>
              </dl>
              <p>
                If the <a>transaction</a> this <a>IDBCursorSync</a> belongs to is not <a>active</a>,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>TransactionInactiveError</code></a>.
              </p>
            </dd>

            <dt>boolean  continue()</dt>
            <dd>
              <p>
                If this cursor's <a>got value</a> flag is false, indicating the cursor is currently being iterated or has iterated past its end,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>InvalidStateError</code></a>.

                If the <var>key</var> parameter is specified and fulfills any of these conditions,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>DataError</code></a>:
              </p>
              <ul>
                <li>The parameter is not a <a>valid key</a>.</li>
                <li>
                  The parameter is <a>less than</a> or <a>equal to</a> this cursor's <a>position</a>
                  and this cursor's <a>direction</a> is <code>"next"</code> or <code>"nextunique"</code>.
                </li>
                <li>
                  The parameter is <a>greater than</a> or <a>equal to</a> this cursor's <a>position</a>
                  and this cursor's <a>direction</a> is <code>"prev"</code> or <code>"prevunique"</code>.
                </li>
              </ul>
              <p>
                Otherwise this method runs the <a>steps for synchronously executing a request</a>.
                The steps are run with the cursor's <a title="cursor source">source</a> as <var>source</var> and the <a>steps
                for iterating a cursor</a> as <var>operation</var>, using the cursor this is called on as <var>cursor</var> and
                the <var>key</var> parameter as <var>key</var>. If the <a>steps for synchronously executing a request</a> returns
                a cursor, then this function returns <code>true</code>. Otherwise this function returns <code>false</code>.
              </p>
              <p>
                Before this method returns, unless an exception was thrown, it sets the <a>got value</a> flag in the cursor to false.
              </p>
              <p>
                Calling this method more than once before new cursor data has been loaded is not allowed
                and results in a <code>DOMException</code> of type <a><code>InvalidStateError</code></a> being thrown.
                For example, calling <code>continue()</code> twice from the same onsuccess handler
                results in a <code>DOMException</code> of type <a><code>InvalidStateError</code></a> being thrown on the second call.
              </p>
              <dl class="parameters">
                <dt>optional any key</dt>
                <dd>The next key to position this <a>cursor</a> at</dd>
              </dl>
              <p>
                If the <a>transaction</a> this <a>IDBCursorSync</a> belongs to is not <a>active</a>,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>TransactionInactiveError</code></a>.
              </p>
            </dd>

            <dt>boolean  delete()</dt>
            <dd>
              <p>
                If the transaction which this <a>IDBCursorSync</a> belongs to has its <a>mode</a> set to <code>"readonly"</code>,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>ReadOnlyError</code></a> 

                If this cursor's <a>got value</a> flag is false, indicating the cursor is currently being iterated or has iterated past its end,
                or if this cursor does not implement the <a>IDBCursorWithValueSync</a> interface,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>InvalidStateError</code></a>.
              </p>
              <p>
                Otherwise this method runs the <a>steps for synchronously executing a request</a>. The steps are run
                with this <a>IDBCursorSync</a> as <var>source</var> and the <a>steps for deleting records from an
                object store</a> as <var>operation</var>, using this cursor's <a>effective object store</a> and
                <a>effective key</a> as <var>store</var> and <var>key</var> respectively. The function returns the
                result of running these steps.
              </p>
              <p>
                If the <a>transaction</a> this <a>IDBCursorSync</a> belongs to is not <a>active</a>,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>TransactionInactiveError</code></a>.
              </p>
            </dd>
          </dl>
          <dl class="idl" title="interface IDBCursorWithValueSync : IDBCursorSync">
            <dt>attribute any value</dt>
            <dd>Returns the cursor's current <a title="cursor value">value</a>.
            Note that if this property returns an object, it returns the same
            object instance every time it is inspected, until the cursor is iterated.
            This means that if the object is modified,
            those modifications will be seen by anyone inspecting the value of the cursor. However modifying such an object
            does not modify the contents of the database.</dd>
          </dl>
        </section>
        <section id="transaction-sync" class="section">
          <h4>Transaction</h4>
          <!-- TODO Add example. Should examples be in a separate section?-->
          <p>
            When an application <a title="create a transaction">creates</a> a
            <a>transaction</a> synchronously, it blocks until the user agent is able
            to reserve the required <a>database</a> objects.
          </p>
          <dl class="idl" title="interface IDBTransactionSync">
            <dt>readonly attribute IDBTransactionMode mode</dt>
            <dd>On getting, provide the <a>mode</a> for isolating access to data inside
            the <a title="object store">object stores</a> that are in the
            <a>scope</a> of the <a>transaction</a>.</dd>
            <dt>attribute IDBDatabaseSync db</dt>
            <dd>The <a>database</a> <a>connection</a> of which this <a>transaction</a>
              is a part</dd>
            <dt>readonly attribute DOMError error</dt>
            <dd>
              If this <a>transaction</a> is not <a title="transaction finish">finished</a>, is <a title="transaction finish">finished</a> but was successfully
              <a title="transaction commit">committed</a>, or was aborted due to a call to the
              <a href="#widl-IDBTransactionSync-abort-void"><code>abort</code></a> function, this property
              returns <code>null</code>.
              If this transaction was aborted due to a failed <a>request</a>, this property returns the same
              <code>DOMError</code> as the <a>request</a> which caused this transaction to be aborted.
              If this transaction was aborted due to an error when committing the <a>transaction</a>, and not due to a failed
              <a>request</a>, this property returns a <code>DOMError</code> which contains the reason for the transaction
              failure (e.g. <code>QuotaExceededError</code> or <code>UnknownError</code>).
            </dd>
            <dt>IDBObjectStoreSync objectStore()</dt>
            <dd>
              Returns an <a>IDBObjectStoreSync</a> representing an <a>object store</a> that is within the <a>scope</a> of this <a>transaction</a>.
              Every call to this function on the same <a>IDBTransactionSync</a> instance and with the same <var>name</var> returns the same <a>IDBObjectStoreSync</a> instance.
              However the retured <a>IDBObjectStoreSync</a> instance is specific to this <a>IDBTransactionSync</a>.
              If this function is called on a different <a>IDBTransactionSync</a>, a different <a>IDBObjectStoreSync</a> instance is returned.
              <dl class="parameters">
                <dt>DOMString name</dt>
                <dd>The requested <a>object store</a></dd>
              </dl>
              <p>
                If the requested <a>object store</a> is not in this <a>transaction</a>'s <a>scope</a>,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>NotFoundError</code></a>.

                If the <a>transaction</a> has finished,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>InvalidStateError</code></a>.
              </p>
            </dd>
            <dt>void abort()</dt>
            <dd>
              <p>
                If this <a>transaction</a> is <a title="transaction finish">finished</a>,
                the implementation MUST throw a <code>DOMException</code> of type <a><code>InvalidStateError</code></a>.
              </p>

              Otherwise this method sets the transactions's <a>active</a> flag to false and
              <a title="transaction abort">aborts</a> the transaction by running the <a>steps for aborting a transaction</a> with the <var>error</var>
              parameter set to <code>null</code>.
            </dd>
          </dl>
          <p class="note">
            Applications MUST not assume that committing the <a>transaction</a>
            produces an instantaneously durable result. The user agent
            MAY delay flushing data to durable storage until an appropriate
            time.
          </p>
          <p>
            Once a <a>transaction</a> is aborted or committed, the <a>active</a>
            <a>transaction</a> on this <a>database</a> <a>connection</a> is removed.
            A new <a>transaction</a> can be created to perform operations atomically.
          </p>
        </section> <!-- IDBTransaction -->
       </section>
      <!-- end-content -->
     </section>
  </body>
</html>
